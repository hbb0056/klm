<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <style>
    body{background:#111;color:white;font-family:Arial;padding:20px}
    button{margin:5px;padding:6px 12px}
    input{padding:6px}
    .box{border:1px solid #444;padding:10px;margin:10px 0}
  </style>
</head>
<body>

<h2>ADMIN PANEL</h2>

<h3>Onay Bekleyenler</h3>
<div id="waitingList"></div>

<h3>Oyuncular</h3>
<div id="playerList"></div>

<h3>Kelime Havuzu</h3>
<input type="text" id="newWord" placeholder="Kelime gir">
<button onclick="addWord()">Ekle</button>
<div id="wordList"></div>

<h3>Turnuva</h3>
<button onclick="startTournament()">Turnuvayı Başlat</button>
<button onclick="resetTournament()">Turnuvayı Sıfırla</button>

<h3>Eleme</h3>
<div id="bracketArea"></div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
  authDomain:"kelime-avi-bec9f.firebaseapp.com",
  databaseURL:"https://kelime-avi-bec9f-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

/* WAITING */
db.ref("waiting").on("value",snap=>{
  let html="";
  snap.forEach(c=>{
    html+=c.val().name+
    " <button onclick=\"approve('"+c.key+"','"+c.val().name+"')\">Onayla</button><br>";
  });
  waitingList.innerHTML=html;
});

function approve(id,name){
  db.ref("players").push({name:name});
  db.ref("waiting/"+id).remove();
}

/* PLAYERS */
db.ref("players").on("value",snap=>{
  let html="";
  snap.forEach(c=>{
    html+=c.val().name+
    " <button onclick=\"kick('"+c.key+"')\">At</button><br>";
  });
  playerList.innerHTML=html;
});

function kick(id){
  db.ref("players/"+id).remove();
}

/* WORDS */
function addWord(){
  let w=newWord.value.trim();
  if(!w) return alert("Kelime boş olamaz");
  db.ref("words").push(w);
  newWord.value="";
}

function deleteWord(id){
  db.ref("words/"+id).remove();
}

db.ref("words").on("value",snap=>{
  let html="";
  snap.forEach(c=>{
    html+=c.val()+
    " <button onclick=\"deleteWord('"+c.key+"')\">Sil</button><br>";
  });
  wordList.innerHTML=html;
});

/* START */
function startTournament(){
  db.ref("players").once("value",snap=>{
    let players=[];
    snap.forEach(c=>players.push(c.val()));

    if(players.length<2){
      alert("En az 2 oyuncu gerekli");
      return;
    }

    db.ref("tournament").remove();

    players.sort(()=>Math.random()-0.5);

    for(let i=0;i<players.length;i+=2){
      db.ref("tournament/matches/m"+i)
      .set({
        p1:players[i].name,
        p2:players[i+1]?players[i+1].name:"",
        winner:""
      });
    }

    db.ref("tournament/status").set("started");
  });
}

/* RESET */
function resetTournament(){
  db.ref("tournament").remove();
  db.ref("tournament/status").set("waiting");
  alert("Turnuva sıfırlandı");
}

/* MATCH */
db.ref("tournament/matches").on("value",snap=>{
  let html="";
  snap.forEach(c=>{
    let m=c.val();
    html+=m.p1+" vs "+m.p2+
    " <button onclick=\"win('"+c.key+"','"+m.p1+"')\">"+m.p1+"</button>"+
    " <button onclick=\"win('"+c.key+"','"+m.p2+"')\">"+m.p2+"</button><br>";
  });
  bracketArea.innerHTML=html;
});

function win(id,name){
  db.ref("tournament/matches/"+id+"/winner").set(name);
  setTimeout(checkRound,500);
}

function checkRound(){
  db.ref("tournament/matches").once("value",snap=>{
    let winners=[];
    snap.forEach(c=>{
      if(c.val().winner)
        winners.push({name:c.val().winner});
    });

    if(winners.length==1){
      db.ref("tournament/champion").set(winners[0].name);
      return;
    }

    if(winners.length>1){
      db.ref("tournament/matches").remove();
      winners.sort(()=>Math.random()-0.5);

      for(let i=0;i<winners.length;i+=2){
        db.ref("tournament/matches/m"+i)
        .set({
          p1:winners[i].name,
          p2:winners[i+1]?winners[i+1].name:"",
          winner:""
        });
      }
    }
  });
}
</script>
</body>
</html>

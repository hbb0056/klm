<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <style>
    body{
      background:black;
      color:white;
      font-family:Arial;
      padding:20px;
    }
    button{margin:5px;padding:5px 10px;}
  </style>
</head>
<body>

<h2>ADMIN PANEL</h2>

<h3>Onay Bekleyenler</h3>
<div id="waiting"></div>

<h3>Onaylanan Oyuncular</h3>
<div id="players"></div>

<button onclick="startTournament()">ðŸŽ® TurnuvayÄ± BaÅŸlat</button>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
var firebaseConfig = {
  apiKey: "APIKEY",
  authDomain: "PROJECT.firebaseapp.com",
  databaseURL: "https://PROJECT-default-rtdb.firebaseio.com",
  projectId: "PROJECT",
};
firebase.initializeApp(firebaseConfig);
var db = firebase.database();


// ONAY BEKLEYENLER
db.ref("waiting").on("value",snap=>{
  let html="";
  snap.forEach(c=>{
    html+=c.val().name+
    " <button onclick=\"approve('"+c.key+"','"+c.val().name+"')\">Onayla</button><br>";
  });
  document.getElementById("waiting").innerHTML=html;
});

function approve(id,name){
  db.ref("players").push({name:name,score:0});
  db.ref("waiting/"+id).remove();
}


// OYUNCU LÄ°STESÄ°
db.ref("players").on("value",snap=>{
  let html="";
  snap.forEach(c=>{
    html+=c.val().name+"<br>";
  });
  document.getElementById("players").innerHTML=html;
});


// ðŸŽ¯ TURNUVA BAÅžLAT
function startTournament(){

  db.ref("players").once("value",snap=>{

    let list=[];
    snap.forEach(c=>{
      list.push({id:c.key,name:c.val().name,score:0});
    });

    if(list.length<2){
      alert("En az 2 oyuncu gerekli");
      return;
    }

    // GRUP OLUÅžTUR (max 4 kiÅŸi)
    let groups=[];
    for(let i=0;i<list.length;i+=4){
      groups.push(list.slice(i,i+4));
    }

    db.ref("tournament/groups").set(groups);
    db.ref("tournament/stage").set("group");

  });

}
</script>

</body>
</html>

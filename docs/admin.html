<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
</head>
<body>

<h2>Yönetici Paneli</h2>

<h3>Onay Bekleyenler</h3>
<div id="waitingList"></div>

<h3>Yeni Soru</h3>
<input type="text" id="hintInput" placeholder="İpucu">
<input type="text" id="wordInput" placeholder="Kelime">
<input type="number" id="letterTime" placeholder="Harf Açılma Süresi (sn)">
<button onclick="startQuestion()">Soruyu Başlat</button>

<h3>Oyuncular</h3>
<div id="playersList"></div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>

var firebaseConfig = {
  apiKey: "AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
  authDomain: "kelime-avi-bec9f.firebaseapp.com",
  databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
  projectId: "kelime-avi-bec9f",
  storageBucket: "kelime-avi-bec9f.firebasestorage.app",
  messagingSenderId: "154681825331",
  appId: "1:154681825331:web:7c8fec41e0d8ee2664eb46"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

db.ref("waitingPlayers").on("child_added", function(snapshot){
  var data = snapshot.val();
  var id = snapshot.key;

  document.getElementById("waitingList").innerHTML +=
    data.name +
    " <button onclick=\"approve('" + id + "','" + data.name + "')\">Onayla</button><br>";
});

function approve(id,name){
  db.ref("players").push({
    name: name,
    score: 0
  });

  db.ref("waitingPlayers/"+id).remove();
}

db.ref("players").on("value", function(snapshot){
  var html="";
  snapshot.forEach(function(child){
    html += child.val().name + " - " + (child.val().score || 0) + " puan<br>";
  });
  document.getElementById("playersList").innerHTML = html;
});

var interval;

function startQuestion(){
  var hint = document.getElementById("hintInput").value;
  var word = document.getElementById("wordInput").value.toUpperCase();
  var time = document.getElementById("letterTime").value * 1000;

  var hidden = "_ ".repeat(word.length);

  db.ref("game/current").set({
    hint: hint,
    word: word,
    displayWord: hidden,
    openedLetters: 0
  });

  var opened = 0;

  clearInterval(interval);

  interval = setInterval(function(){
    opened++;

    var display="";
    for(var i=0;i<word.length;i++){
      if(i<opened){
        display += word[i] + " ";
      } else {
        display += "_ ";
      }
    }

    db.ref("game/current").update({
      displayWord: display,
      openedLetters: opened
    });

    if(opened >= word.length){
      clearInterval(interval);
    }

  }, time);
}

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>DÃ¼ello ArenasÄ±</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #0f3460; color: white; padding-top: 30px; }
        .arena { background: #16213e; padding: 30px; display: inline-block; border-radius: 20px; width: 90%; max-width: 600px; border: 2px solid #e94560; box-shadow: 0 0 20px rgba(233, 69, 96, 0.3); }
        .skor-board { font-size: 28px; font-weight: bold; background: #1a1a2e; padding: 15px; border-radius: 10px; margin-bottom: 20px; color: #f1c40f; border: 1px solid #333; }
        #kelime { font-size: 45px; letter-spacing: 10px; font-family: 'Courier New', monospace; margin: 20px 0; background: #1a1a2e; padding: 20px; border-radius: 10px; color: #00d2ff; }
        input { padding: 15px; font-size: 20px; width: 80%; border-radius: 10px; border: none; margin-bottom: 10px; text-align: center; outline: none; background: #eef2f3; color: #333; }
        button { padding: 15px 40px; font-size: 20px; background: #e94560; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:hover { background: #ff4d6d; transform: scale(1.05); }
        button:disabled { background: #555; cursor: not-allowed; }
        #mesaj { font-size: 18px; margin-top: 15px; color: #a2a8d3; min-height: 25px; }
    </style>
</head>
<body>
    <div class="arena">
        <div id="raunt-no" style="color:#e94560; font-weight:bold; margin-bottom:5px;">Raunt: 1 / 3</div>
        <div class="skor-board" id="skor">SÄ°Z 0 - 0 RAKÄ°P</div>
        <p>Ä°pucu: <span id="ipucu" style="color:#f1c40f">...</span></p>
        <div id="kelime">-----</div>
        <input id="tahmin" placeholder="CevabÄ±nÄ±zÄ± buraya yazÄ±n..." autofocus onkeypress="if(event.key === 'Enter') gonder()">
        <br>
        <button id="btn" onclick="gonder()">CEVABI GÃ–NDER</button>
        <p id="mesaj">HÄ±zlÄ± ve doÄŸru olan puanÄ± kapar!</p>
    </div>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
            authDomain: "kelime-avi-bec9f.firebaseapp.com",
            databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
            projectId: "kelime-avi-bec9f",
            storageBucket: "kelime-avi-bec9f.appspot.com",
            messagingSenderId: "154681825331",
            appId: "1:154681825331:web:7c8fec41e0d8ee2664eb46"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();
        var id = localStorage.getItem("turnuva_id");
        var macID = "";
        var dogruCevap = "";

        db.ref("turnuva/maclar").on("value", s => {
            s.forEach(m => {
                var v = m.val();
                if((v.p1 === id || v.p2 === id) && v.durum === "aktif") {
                    macID = m.key;
                    var r = v.aktifRaunt;
                    if(!v.kelimeler[r]) return;

                    dogruCevap = v.kelimeler[r].k;
                    document.getElementById("kelime").innerText = v.kelimeler[r].gizli;
                    document.getElementById("ipucu").innerText = v.kelimeler[r].i;
                    document.getElementById("raunt-no").innerText = "Raunt: " + (r + 1) + " / 3";
                    
                    var s1 = v.p1_skor || 0;
                    var s2 = v.p2_skor || 0;
                    document.getElementById("skor").innerText = (v.p1 === id) ? `SÄ°Z ${s1} - ${s2} RAKÄ°P` : `SÄ°Z ${s2} - ${s1} RAKÄ°P`;
                    document.getElementById("btn").disabled = false;
                    document.getElementById("mesaj").innerText = "Cevap bekleniyor...";
                }
            });
        });

        function gonder() {
            var t = document.getElementById("tahmin").value.toUpperCase().trim();
            if(t === "") return;
            
            document.getElementById("btn").disabled = true;
            document.getElementById("tahmin").value = "";

            db.ref("turnuva/maclar/" + macID).transaction(mac => {
                if(mac && mac.durum === "aktif") {
                    var r = mac.aktifRaunt;
                    // EÄŸer cevap doÄŸruysa puanÄ± yaz
                    if(t === mac.kelimeler[r].k) {
                        if(mac.p1 === id) mac.p1_skor = (mac.p1_skor || 0) + 1;
                        else mac.p2_skor = (mac.p2_skor || 0) + 1;
                    }

                    // YanlÄ±ÅŸ da olsa doÄŸru da olsa bir sonraki kelimeye geÃ§
                    if(mac.aktifRaunt < 2 && mac.p1_skor < 2 && mac.p2_skor < 2) {
                        mac.aktifRaunt++;
                    } else {
                        mac.durum = "bitti";
                        mac.winner = (mac.p1_skor >= mac.p2_skor) ? mac.p1 : mac.p2;
                    }
                }
                return mac;
            });
        }

        db.ref("turnuva/maclar").on("child_changed", s => {
            if(s.key === macID && s.val().durum === "bitti") {
                var w = s.val().winner;
                alert(w === id ? "ğŸ† TEBRÄ°KLER! Bir Ã¼st tura yÃ¼kseldin!" : "âŒ Elendin! Bir sonraki turnuvada baÅŸarÄ±lar.");
                window.location.href = "index.html";
            }
        });
    </script>
</body>
</html>

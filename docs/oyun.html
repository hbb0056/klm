<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Kelime AvÄ± - YarÄ±ÅŸma</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #f0f2f5; padding-top: 30px; }
        #kelime { font-size: 45px; letter-spacing: 12px; margin: 20px; font-family: 'Courier New', monospace; color: #333; }
        .info-box { background: white; padding: 20px; display: inline-block; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 80%; }
        input { padding: 15px; font-size: 18px; width: 70%; margin-bottom: 10px; border: 2px solid #ddd; border-radius: 8px; }
        button { padding: 15px 30px; font-size: 18px; background: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; }
        button:disabled { background: #ccc; }
        #mesaj { font-weight: bold; margin-top: 15px; color: #555; }
    </style>
</head>
<body>
    <div class="info-box">
        <h1>ğŸ¯ Kelime AvÄ±</h1>
        <p><strong>Ä°pucu:</strong> <span id="anlam">YÃ¼kleniyor...</span></p>
        <h2 id="kelime">-----</h2>
        
        <input id="tahmin" placeholder="Tahmininizi yazÄ±n...">
        <button id="btnGonder" onclick="gonder()">GÃ¶nder</button>
        <p id="mesaj">CevabÄ±nÄ± yaz ve gÃ¶nder!</p>
    </div>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
            authDomain: "kelime-avi-bec9f.firebaseapp.com",
            databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
            projectId: "kelime-avi-bec9f",
            storageBucket: "kelime-avi-bec9f.appspot.com",
            messagingSenderId: "154681825331",
            appId: "1:154681825331:web:7c8fec41e0d8ee2664eb46"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();
        
        var ogrenciID = localStorage.getItem("id");
        var dogruKelime = "";
        var guncelPuan = 0;
        var kelimeID = "";

        // Aktif kelimeyi ve puanÄ± dinle
        db.ref("aktif").on("value", function(s){
            var d = s.val();
            if(!d) return;

            // EÄŸer yeni bir kelimeye geÃ§ildiyse arayÃ¼zÃ¼ sÄ±fÄ±rla
            if(kelimeID !== d.kelime){
                kelimeID = d.kelime;
                dogruKelime = d.kelime;
                guncelPuan = d.puan;
                document.getElementById("tahmin").disabled = false;
                document.getElementById("btnGonder").disabled = false;
                document.getElementById("tahmin").value = "";
                document.getElementById("mesaj").innerText = "Yeni kelime! CevabÄ±nÄ± gÃ¶nder.";
                document.getElementById("mesaj").style.color = "#555";
            }
            
            // Harfler ve Puan Ã¶ÄŸretmen tarafÄ±nda deÄŸiÅŸtikÃ§e gÃ¼ncellenir
            document.getElementById("anlam").innerText = d.anlam;
            document.getElementById("kelime").innerText = d.gizli;
            guncelPuan = d.puan; 
        });

        function gonder(){
            var t = document.getElementById("tahmin").value.toUpperCase().trim();
            if(t == "") return;

            // Ã–ÄŸretmene sonucu sessizce gÃ¶nder
            if(t === dogruKelime){
                // DoÄŸruysa puanÄ± transaction ile ekle
                db.ref("ogrenciler/"+ogrenciID+"/puan").transaction(function(p){
                    return (p || 0) + guncelPuan;
                });
            }

            // ArayÃ¼zÃ¼ kilitle (Geri dÃ¶nÃ¼t yok!)
            document.getElementById("tahmin").disabled = true;
            document.getElementById("btnGonder").disabled = true;
            document.getElementById("mesaj").innerText = "âœ”ï¸ CevabÄ±n kaydedildi. DiÄŸer kelime bekleniyor...";
            document.getElementById("mesaj").style.color = "blue";
        }
    </script>
</body>
</html>

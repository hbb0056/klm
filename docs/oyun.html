<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Kelime AvÄ± - YarÄ±ÅŸma</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #eef2f3; padding-top: 50px; }
        .game-card { background: white; padding: 30px; display: inline-block; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 85%; max-width: 600px; position: relative; }
        #kelime { font-size: 45px; letter-spacing: 15px; margin: 30px 0; font-family: 'Courier New', monospace; color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        input { padding: 15px; font-size: 20px; width: 80%; border: 2px solid #3498db; border-radius: 10px; margin-bottom: 10px; text-align: center; }
        button { padding: 15px 40px; font-size: 20px; background: #3498db; color: white; border: none; border-radius: 10px; cursor: pointer; }
        #mesaj { margin-top: 20px; font-size: 18px; font-weight: bold; color: #7f8c8d; }
        #sonucOverlay { display:none; position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.95); border-radius:20px; flex-direction:column; justify-content:center; align-items:center; z-index:10; }
    </style>
</head>
<body>
    <div class="game-card">
        <div id="sonucOverlay">
            <h2 id="sonucDurum">DoÄŸru!</h2>
            <p id="sonucDetay">Kelime: ELMA | Puan: +25</p>
        </div>

        <h1>ðŸŽ¯ Kelime AvÄ±</h1>
        <p><strong>Ä°pucu:</strong> <span id="anlam">...</span></p>
        <div id="kelime">----</div>
        <input id="tahmin" placeholder="Tahmininizi yazÄ±n...">
        <br>
        <button id="btnGonder" onclick="gonder()">GÃ¶nder</button>
        <p id="mesaj">BaÅŸarÄ±lar!</p>
    </div>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
            authDomain: "kelime-avi-bec9f.firebaseapp.com",
            databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
            projectId: "kelime-avi-bec9f",
            storageBucket: "kelime-avi-bec9f.appspot.com",
            messagingSenderId: "154681825331",
            appId: "1:154681825331:web:7c8fec41e0d8ee2664eb46"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();
        var ogrenciID = localStorage.getItem("id");
        var dogruCevap = "";
        var oAnkiPuan = 0;
        var sonKazanc = 0;

        db.ref("oyunDurum").on("value", d => { if(d.val() !== "acik") window.location.href = "index.html"; });

        db.ref("aktif").on("value", s => {
            var d = s.val();
            if(!d) return;

            if(dogruCevap !== d.kelime){
                // EÄžER ESKÄ° BÄ°R KELÄ°ME VARSA SONUCU GÃ–STER
                if(dogruCevap !== ""){
                    gosterSonuc();
                }
                dogruCevap = d.kelime;
                sonKazanc = 0;
                document.getElementById("tahmin").disabled = false;
                document.getElementById("btnGonder").disabled = false;
                document.getElementById("tahmin").value = "";
                document.getElementById("mesaj").innerText = "Yeni Kelime!";
            }
            document.getElementById("anlam").innerText = d.anlam;
            document.getElementById("kelime").innerText = d.gizli;
            oAnkiPuan = d.puan;
        });

        function gonder(){
            var t = document.getElementById("tahmin").value.toUpperCase().trim();
            if(t == "" || !dogruCevap) return;
            if(t === dogruCevap){
                sonKazanc = oAnkiPuan;
                db.ref("ogrenciler/"+ogrenciID+"/puan").transaction(p => (p||0) + oAnkiPuan);
                document.getElementById("mesaj").innerText = "âœ”ï¸ CevabÄ±n alÄ±ndÄ±. Bekle...";
            } else {
                sonKazanc = 0;
                document.getElementById("mesaj").innerText = "âœ”ï¸ CevabÄ±n alÄ±ndÄ± (YanlÄ±ÅŸ olsa bile kaydedildi).";
            }
            document.getElementById("tahmin").disabled = true;
            document.getElementById("btnGonder").disabled = true;
        }

        function gosterSonuc(){
            var overlay = document.getElementById("sonucOverlay");
            document.getElementById("sonucDurum").innerText = sonKazanc > 0 ? "âœ… TEBRÄ°KLER!" : "âŒ OLMADI...";
            document.getElementById("sonucDetay").innerText = "Kelime: " + dogruCevap + " | KazandÄ±ÄŸÄ±n: " + sonKazanc;
            overlay.style.display = "flex";
            setTimeout(() => { overlay.style.display = "none"; }, 5000); // 5 saniye gÃ¶ster
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<title>Oyun</title>
<style>
body{background:black;color:white;text-align:center;font-family:Arial}
#timer{font-size:40px;color:red}
</style>
</head>
<body>

<div id="login">
<input id="name" placeholder="Ad">
<button onclick="join()">Gir</button>
</div>

<div id="waiting" style="display:none">Onay bekleniyor...</div>

<div id="game" style="display:none">
<h2 id="word"></h2>
<div id="timer">30</div>
<h3>PuanÄ±n: <span id="score">0</span></h3>
</div>

<div id="champion" style="display:none">
<h1>ğŸ† ÅAMPÄ°YON ğŸ†</h1>
<h2 id="champName"></h2>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
const firebaseConfig={
apiKey:"AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
authDomain:"kelime-avi-bec9f.firebaseapp.com",
databaseURL:"https://kelime-avi-bec9f-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let myName="";
let myScore=0;
let time=30;
let interval;

/* GÄ°RÄ°Å */
function join(){
  myName=name.value;
  db.ref("waiting").push({name:myName});
  login.style.display="none";
  waiting.style.display="block";
}

/* ONAY */
db.ref("players").on("value",snap=>{
  snap.forEach(c=>{
    if(c.val().name==myName){
      waiting.innerHTML="OnaylandÄ±";
    }
  });
});

/* BAÅLAT */
db.ref("tournament/status").on("value",snap=>{
  if(snap.val()=="started"){
    waiting.style.display="none";
    game.style.display="block";
    newWord();
    startTimer();
  }
});

/* KELÄ°ME */
function newWord(){
  db.ref("words").once("value",snap=>{
    let arr=[];
    snap.forEach(c=>arr.push(c.val()));
    if(arr.length>0)
      word.innerText=arr[Math.floor(Math.random()*arr.length)];
  });
}

/* SÃœRE */
function startTimer(){
  interval=setInterval(()=>{
    time--;
    timer.innerText=time;
    if(time<=0){
      time=30;
      newWord();
    }
  },1000);
}

/* ÅAMPÄ°YON */
db.ref("tournament/champion").on("value",snap=>{
  if(snap.val()){
    game.style.display="none";
    champion.style.display="block";
    champName.innerText=snap.val();
  }
});

/* OYUNDAN ATILMA */
db.ref("players").on("value",snap=>{
  let exists=false;
  snap.forEach(c=>{
    if(c.val().name==myName) exists=true;
  });
  if(!exists && myName!=""){
    alert("Oyundan Ã§Ä±karÄ±ldÄ±nÄ±z");
    location.reload();
  }
});
</script>
</body>
</html>

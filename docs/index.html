<!DOCTYPE html>
<html>
<head>
  <title>Katılımcı Sayfası</title>
  <style>
    body{
      background:black;
      color:white;
      font-family:Arial;
      text-align:center;
      padding-top:50px;
    }
    input,button{
      padding:10px;
      margin:5px;
    }
  </style>
</head>
<body>

<div id="loginScreen">
  <h2>Oyuna Katıl</h2>
  <input type="text" id="playerName" placeholder="Adınızı girin">
  <button onclick="joinGame()">Giriş Yap</button>
</div>

<div id="waitingScreen" style="display:none;">
  <h2>Onay Bekleniyor...</h2>
</div>

<div id="gameScreen" style="display:none;">
  <h2>Oyun Başladı!</h2>
  <h3 id="wordArea"></h3>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>

const firebaseConfig = {
  apiKey: "AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
  authDomain: "kelime-avi-bec9f.firebaseapp.com",
  databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
  projectId: "kelime-avi-bec9f",
  storageBucket: "kelime-avi-bec9f.firebasestorage.app",
  messagingSenderId: "154681825331",
  appId: "1:154681825331:web:7c8fec41e0d8ee2664eb46"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let myName="";
let myWaitingKey="";

function joinGame(){
  let name=document.getElementById("playerName").value.trim();
  if(name==""){
    alert("İsim giriniz");
    return;
  }

  myName=name;

  let ref=db.ref("waiting").push();
  ref.set({
    name:name
  });

  myWaitingKey=ref.key;

  document.getElementById("loginScreen").style.display="none";
  document.getElementById("waitingScreen").style.display="block";
}


// ADMIN ONAY KONTROLÜ
db.ref("players").on("value", snapshot=>{
  snapshot.forEach(child=>{
    if(child.val().name==myName){
      document.getElementById("waitingScreen").innerHTML="<h2>Onaylandı. Turnuva başlatılmayı bekliyor...</h2>";
    }
  });
});


// TURNAVA BAŞLAMA KONTROLÜ
db.ref("tournament/status").on("value", snapshot=>{
  if(snapshot.val()=="started"){
    document.getElementById("waitingScreen").style.display="none";
    document.getElementById("gameScreen").style.display="block";
    loadRandomWord();
  }
});


// RASTGELE KELİME
function loadRandomWord(){
  db.ref("words").once("value", snapshot=>{
    let words=[];
    snapshot.forEach(child=>{
      words.push(child.val());
    });

    if(words.length>0){
      let random=words[Math.floor(Math.random()*words.length)];
      document.getElementById("wordArea").innerText=random;
    }else{
      document.getElementById("wordArea").innerText="Kelime bulunamadı";
    }
  });
}

</script>

</body>
</html>

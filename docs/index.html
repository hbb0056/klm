<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Kelime AvÄ± - GiriÅŸ</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>

<body>

<h2>ğŸ‘¨â€ğŸ“ Oyuna KatÄ±l</h2>

<input id="ad" placeholder="AdÄ±nÄ± yaz">
<br><br>

<button onclick="giris()">KatÄ±l</button>

<p id="durum"></p>

<script>

var firebaseConfig = {
  apiKey: "AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
  authDomain: "kelime-avi-bec9f.firebaseapp.com",
  databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
  projectId: "kelime-avi-bec9f",
  storageBucket: "kelime-avi-bec9f.appspot.com",
  messagingSenderId: "154681825331",
  appId: "1:154681825331:web:7c8fec41e0d8ee2664eb46"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

var id = localStorage.getItem("id");

if(!id){
  id = db.ref("ogrenciler").push().key;
  localStorage.setItem("id",id);
}


/* GÄ°RÄ°Å */
function giris(){

  var ad=document.getElementById("ad").value.trim();

  if(ad==""){
    alert("Ad yazmadan olmaz!");
    return;
  }

  db.ref("ogrenciler/"+id).set({
    ad:ad,
    onay:false,
    puan:0
  });

  document.getElementById("durum").innerText="â³ Onay bekleniyor...";
}


/* ONAY + OYUN KÄ°LÄ°DÄ° */

db.ref("ogrenciler/"+id+"/onay").on("value",function(s){

  if(s.val()==true){

    // oyun aÃ§Ä±k mÄ±?
    db.ref("oyunDurum").once("value",function(d){

      if(d.val()=="acik"){

        window.location="oyun.html";

      }else{

        document.getElementById("durum").innerText=
        "âœ”ï¸ OnaylandÄ±, oyun bekleniyor...";
      }
    });
  }
});


/* OYUN AÃ‡ILINCA GÄ°R */

db.ref("oyunDurum").on("value",function(s){

  if(s.val()=="acik"){

    db.ref("ogrenciler/"+id+"/onay").once("value",function(d){

      if(d.val()==true){

        window.location="oyun.html";
      }
    });
  }
});

</script>

</body>
</html>

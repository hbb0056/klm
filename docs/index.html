<!DOCTYPE html>
<html>
<head>
<title>Oyun</title>
<style>
body{background:#111;color:white;text-align:center;font-family:Arial}
#timer{font-size:40px;color:red}
</style>
</head>
<body>

<div id="login">
<input id="name" placeholder="Ad">
<button onclick="join()">Gir</button>
</div>

<div id="waiting" style="display:none">Onay bekleniyor...</div>

<div id="game" style="display:none">
<h2 id="word"></h2>
<div id="timer">30</div>
</div>

<div id="champion" style="display:none">
<h1>ğŸ† ÅAMPÄ°YON ğŸ†</h1>
<h2 id="champName"></h2>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig={
apiKey:"AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
authDomain:"kelime-avi-bec9f.firebaseapp.com",
databaseURL:"https://kelime-avi-bec9f-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let myName=localStorage.getItem("playerName")||"";
let gameStarted=false;
let interval;
let time=30;

/* AUTO LOGIN */
if(myName){
  login.style.display="none";
  waiting.style.display="block";
}

/* JOIN */
function join(){
  if(!name.value.trim()) return alert("Ä°sim giriniz");
  myName=name.value.trim();
  localStorage.setItem("playerName",myName);
  db.ref("waiting").push({name:myName});
  login.style.display="none";
  waiting.style.display="block";
}

/* ONAY */
db.ref("players").on("value",snap=>{
  let approved=false;
  snap.forEach(c=>{
    if(c.val().name==myName) approved=true;
  });
  if(approved){
    waiting.innerHTML="OnaylandÄ±. BaÅŸlatma bekleniyor...";
  }
});

/* STATUS */
db.ref("tournament/status").on("value",snap=>{
  if(snap.val()=="started" && !gameStarted){
    gameStarted=true;
    waiting.style.display="none";
    game.style.display="block";
    newWord();
    startTimer();
  }
});

/* WORD */
function newWord(){
  db.ref("words").once("value",snap=>{
    let arr=[];
    snap.forEach(c=>arr.push(c.val()));
    if(arr.length>0)
      word.innerText=arr[Math.floor(Math.random()*arr.length)];
    else
      word.innerText="Kelime yok";
  });
}

/* TIMER */
function startTimer(){
  clearInterval(interval);
  interval=setInterval(()=>{
    time--;
    timer.innerText=time;
    if(time<=0){
      time=30;
      newWord();
    }
  },1000);
}

/* CHAMPION */
db.ref("tournament/champion").on("value",snap=>{
  if(snap.val()){
    game.style.display="none";
    champion.style.display="block";
    champName.innerText=snap.val();
  }
});

/* KICK CONTROL */
db.ref("players").on("value",snap=>{
  let exists=false;
  snap.forEach(c=>{
    if(c.val().name==myName) exists=true;
  });
  if(!exists && myName){
    alert("Oyundan Ã§Ä±karÄ±ldÄ±nÄ±z");
    localStorage.removeItem("playerName");
    location.reload();
  }
});
</script>
</body>
</html>

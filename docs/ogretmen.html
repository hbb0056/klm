<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Turnuva YÃ¶netimi - GeliÅŸmiÅŸ Havuz</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f4f7f6; color: #333; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .flex-row { display: flex; gap: 10px; margin-bottom: 15px; }
        input { padding: 12px; border: 2px solid #ddd; border-radius: 8px; flex: 1; outline: none; }
        button { cursor: pointer; padding: 12px 20px; border-radius: 8px; border: none; font-weight: bold; transition: 0.3s; }
        .btn-green { background: #27ae60; color: white; }
        .btn-red { background: #c0392b; color: white; }
        .btn-delete { background: #ff7675; color: white; padding: 5px 12px; font-size: 12px; }
        
        /* Kelime Listesi TasarÄ±mÄ± */
        #kelimeListesi { background: #fff; border-radius: 10px; border: 1px solid #eee; margin-top: 10px; }
        .word-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; border-bottom: 1px solid #f1f1f1; }
        .word-item:last-child { border-bottom: none; }
        .word-text { font-size: 1.1em; }
        .word-text b { color: #2980b9; }

        /* MaÃ§ KartlarÄ± */
        .match-card { background: #1a1a2e; color: white; padding: 15px; border-radius: 10px; margin-top: 10px; border-left: 5px solid #e94560; }
        .winner { color: #2ecc71; font-weight: bold; }
        .loser { color: #e74c3c; text-decoration: line-through; opacity: 0.7; }
    </style>
</head>
<body>
    <h1>ğŸŸï¸ Turnuva YÃ¶netim Merkezi</h1>

    <div class="card">
        <h3>ğŸ“š Kelime Havuzu YÃ¶netimi</h3>
        <div class="flex-row">
            <input id="k" placeholder="Kelime (Ã–rn: ANKARA)"> 
            <input id="a" placeholder="Ä°pucu (Ã–rn: BaÅŸkentimiz)">
            <button class="btn-green" onclick="ekle()">HAVUZA EKLE</button>
        </div>
        
        <div id="kelimeListesi">
            <p style="padding:15px; color:#888;">HenÃ¼z kelime eklenmedi.</p>
        </div>
    </div>

    <div class="card">
        <h3>âš™ï¸ Turnuva Kontrolleri</h3>
        <button class="btn-green" style="font-size: 1.2em; padding: 15px 30px;" onclick="eslestir()">âš”ï¸ TUR EÅLEÅMELERÄ°NÄ° BAÅLAT</button>
        <button class="btn-red" onclick="sifirla()">ğŸ§¹ SÄ°STEMÄ° SIFIRLA</button>
    </div>

    <div class="card">
        <h3>ğŸ“Š Åampiyonlar Ligi MaÃ§ Tablosu</h3>
        <div id="macListesi">HenÃ¼z baÅŸlayan maÃ§ yok.</div>
    </div>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
            authDomain: "kelime-avi-bec9f.firebaseapp.com",
            databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
            projectId: "kelime-avi-bec9f",
            storageBucket: "kelime-avi-bec9f.appspot.com",
            messagingSenderId: "154681825331",
            appId: "1:154681825331:web:7c8fec41e0d8ee2664eb46"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();

        // 1. KELÄ°ME EKLEME FONKSÄ°YONU
        function ekle() {
            var k = document.getElementById("k").value.toUpperCase().trim();
            var a = document.getElementById("a").value.trim();
            if(k && a) {
                db.ref("turnuva/havuz").push({ k: k, a: a });
                document.getElementById("k").value = "";
                document.getElementById("a").value = "";
            } else {
                alert("LÃ¼tfen hem kelimeyi hem de ipucunu doldurun!");
            }
        }

        // 2. KELÄ°ME HAVUZUNU ANLIK LÄ°STELEME (BurasÄ± listeyi gÃ¶sterir)
        db.ref("turnuva/havuz").on("value", snapshot => {
            var listDiv = document.getElementById("kelimeListesi");
            var html = "";
            if (!snapshot.exists()) {
                html = '<p style="padding:15px; color:#888;">Havuzda kelime yok. LÃ¼tfen yukarÄ±dan ekleyin.</p>';
            } else {
                snapshot.forEach(child => {
                    var data = child.val();
                    html += `
                        <div class="word-item">
                            <span class="word-text"><b>${data.k}</b> - <i>${data.a}</i></span>
                            <button class="btn-delete" onclick="db.ref('turnuva/havuz/${child.key}').remove()">SÄ°L</button>
                        </div>
                    `;
                });
            }
            listDiv.innerHTML = html;
        });

        // 3. EÅLEÅTÄ°RME MANTIÄI
        function eslestir() {
            db.ref("turnuva").once("value", ts => {
                var havuz = [];
                ts.child("havuz").forEach(h => { havuz.push(h.val()); });
                if(havuz.length < 3) return alert("Turnuva iÃ§in en az 3 kelime eklemelisiniz!");

                var bekleyenler = [];
                ts.child("oyuncular").forEach(o => { 
                    if(o.val().durum === "bekliyor") bekleyenler.push({id: o.key, ad: o.val().ad}); 
                });

                if(bekleyenler.length < 2) return alert("EÅŸleÅŸecek yeterli oyuncu yok!");

                for(let i=0; i < bekleyenler.length; i+=2) {
                    if(bekleyenler[i+1]) {
                        var p1 = bekleyenler[i], p2 = bekleyenler[i+1];
                        var secilenler = havuz.sort(() => 0.5 - Math.random()).slice(0,3).map(x => ({
                            k: x.k, i: x.a, gizli: x.k.replace(/[A-ZÃ‡ÄÄ°Ã–ÅÃœ]/g, "-")
                        }));

                        var mid = db.ref("turnuva/maclar").push().key;
                        db.ref("turnuva/maclar/"+mid).set({
                            p1: p1.id, p2: p2.id, p1_ad: p1.ad, p2_ad: p2.ad,
                            kelimeler: secilenler, aktifRaunt: 0, p1_skor: 0, p2_skor: 0, durum: "aktif", winner: ""
                        });
                        db.ref("turnuva/oyuncular/"+p1.id+"/durum").set("eslesti");
                        db.ref("turnuva/oyuncular/"+p2.id+"/durum").set("eslesti");
                    }
                }
            });
        }

        // 4. MAÃ‡LARI VE GRUPLARI Ä°ZLEME
        db.ref("turnuva").on("value", s => {
            var mList = document.getElementById("macListesi");
            var html = "";
            var maclar = s.child("maclar");

            if (!maclar.exists()) {
                html = "Aktif dÃ¼ello bulunmuyor.";
            } else {
                maclar.forEach(m => {
                    var v = m.val();
                    var durumText = v.durum === "aktif" ? "ğŸ”¥ CANLI" : "ğŸ BÄ°TTÄ°";
                    html += `
                        <div class="match-card">
                            <small>${durumText} - Raunt: ${v.aktifRaunt + 1}</small><br>
                            <span class="${v.winner === v.p1 ? 'winner' : (v.durum==='bitti'?'loser':'')}">${v.p1_ad} (${v.p1_skor})</span> 
                            vs 
                            <span class="${v.winner === v.p2 ? 'winner' : (v.durum==='bitti'?'loser':'')}">${v.p2_ad} (${v.p2_skor})</span>
                        </div>
                    `;

                    // Otomatik Tur Atlama KontrolÃ¼
                    if(v.durum === "bitti" && v.winner !== "") {
                        db.ref("turnuva/oyuncular/"+v.winner+"/durum").set("bekliyor");
                        var loser = v.winner === v.p1 ? v.p2 : v.p1;
                        db.ref("turnuva/oyuncular/"+loser+"/durum").set("elendi");
                    }
                });
            }
            mList.innerHTML = html;
        });

        function sifirla() {
            if(confirm("TÃ¼m turnuva verileri silinecek!")) {
                db.ref("turnuva").remove();
                location.reload();
            }
        }
    </script>
</body>
</html>

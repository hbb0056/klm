<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Ã–ÄŸretmen Paneli</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: Arial; padding: 20px; background: #fdfdfd; }
        .box { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 8px; background: white; }
        button { cursor: pointer; padding: 5px 10px; margin: 2px; }
        .onayli { color: green; font-weight: bold; }
        .bekliyor { color: orange; }
    </style>
</head>
<body>
    <h2>ğŸ‘©â€ğŸ« Ã–ÄŸretmen Kontrol Paneli</h2>

    <div class="box">
        <h3>ğŸ® Oyun KontrolÃ¼</h3>
        <button style="background:green; color:white;" onclick="oyunAc()">OYUNU AÃ‡ (GiriÅŸlere Ä°zin Ver)</button>
        <button style="background:red; color:white;" onclick="oyunKapat()">OYUNU KAPAT</button>
        <button onclick="puanlariSifirla()">ğŸ§¹ TÃ¼m PuanlarÄ± SÄ±fÄ±rla</button>
    </div>

    <div class="box">
        <h3>ğŸ‘¨â€ğŸ“ Ã–ÄŸrenci Listesi (SÄ±ralama)</h3>
        <div id="ogrenciListesi"></div>
    </div>

    <div class="box">
        <h3>â• Kelime Havuzu</h3>
        <input id="k" placeholder="Kelime"> <input id="a" placeholder="Anlam/Ä°pucu">
        <button onclick="kelimeEkle()">Havuzuna Ekle</button>
        <div id="havuz" style="margin-top:10px;"></div>
    </div>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
            authDomain: "kelime-avi-bec9f.firebaseapp.com",
            databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
            projectId: "kelime-avi-bec9f",
            storageBucket: "kelime-avi-bec9f.appspot.com",
            messagingSenderId: "154681825331",
            appId: "1:154681825331:web:7c8fec41e0d8ee2664eb46"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();
        var harfInterval;

        // Ã–ÄŸrencileri Dinle
        db.ref("ogrenciler").on("value", function(s){
            var liste = [];
            s.forEach(e => { liste.push({id:e.key, ...e.val()}) });
            liste.sort((a,b) => (b.puan||0) - (a.puan||0));

            var html = "<table border='1' width='100%'><tr><th>SÄ±ra</th><th>Ad</th><th>Puan</th><th>Durum</th><th>Ä°ÅŸlem</th></tr>";
            liste.forEach((o, i) => {
                html += `<tr>
                    <td>${i+1}</td>
                    <td>${o.ad}</td>
                    <td>${o.puan||0}</td>
                    <td class="${o.onay?'onayli':'bekliyor'}">${o.onay?'OnaylandÄ±':'Bekliyor'}</td>
                    <td><button onclick="onayla('${o.id}')">Onayla</button></td>
                </tr>`;
            });
            document.getElementById("ogrenciListesi").innerHTML = html + "</table>";
        });

        function onayla(id){ db.ref("ogrenciler/"+id+"/onay").set(true); }
        function oyunAc(){ db.ref("oyunDurum").set("acik"); alert("Oyun aÃ§Ä±ldÄ±, Ã¶ÄŸrenciler girebilir."); }
        function oyunKapat(){ db.ref("oyunDurum").set("kapali"); alert("Oyun kapandÄ±."); }
        function puanlariSifirla(){
            if(confirm("TÃ¼m puanlar silinecek?")){
                db.ref("ogrenciler").once("value", s => {
                    s.forEach(e => { db.ref("ogrenciler/"+e.key+"/puan").set(0); });
                });
            }
        }

        function kelimeEkle(){
            var k = document.getElementById("k").value.toUpperCase().trim();
            var a = document.getElementById("a").value.trim();
            if(k && a) db.ref("kelimeler").push({kelime:k, anlam:a});
        }

        // Kelime Havuzunu Listele
        db.ref("kelimeler").on("value", s => {
            var html = "";
            s.forEach(e => {
                var d = e.val();
                html += `<div><b>${d.kelime}</b>: ${d.anlam} 
                <button onclick="kelimeBaslat('${e.key}')">â–¶ BAÅLAT</button>
                <button onclick="db.ref('kelimeler/${e.key}').remove()">âŒ</button></div>`;
            });
            document.getElementById("havuz").innerHTML = html;
        });

        function kelimeBaslat(id){
            if(harfInterval) clearInterval(harfInterval);
            db.ref("kelimeler/"+id).once("value", s => {
                var d = s.val();
                var kelime = d.kelime;
                var gizli = kelime.replace(/./g, "-");
                var puan = 100;

                var guncelle = (g, p) => db.ref("aktif").set({kelime:kelime, gizli:g, anlam:d.anlam, puan:p});
                guncelle(gizli, puan);

                harfInterval = setInterval(() => {
                    var kapali = [];
                    for(var i=0; i<gizli.length; i++) if(gizli[i]=="-") kapali.push(i);

                    if(kapali.length > 1 && puan > 10){
                        var secilen = kapali[Math.floor(Math.random()*kapali.length)];
                        var dizi = gizli.split("");
                        dizi[secilen] = kelime[secilen];
                        gizli = dizi.join("");
                        puan -= 10;
                        guncelle(gizli, puan);
                    } else {
                        clearInterval(harfInterval);
                    }
                }, 20000);
                alert("Kelime gÃ¶nderildi, 20sn sayacÄ± baÅŸladÄ±!");
            });
        }
    </script>
</body>
</html>

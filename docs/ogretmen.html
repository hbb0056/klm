<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Ã–ÄŸretmen Paneli - Turnuva Kontrol</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f2f5; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .setting-row { display: flex; align-items: center; gap: 15px; background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        button { cursor: pointer; padding: 10px 20px; border-radius: 8px; border: none; font-weight: bold; }
        .btn-green { background: #27ae60; color: white; }
        .btn-blue { background: #3498db; color: white; }
        .btn-red { background: #e74c3c; color: white; }
        .match-card { background: #2c3e50; color: white; padding: 10px; margin: 5px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ğŸŸï¸ Turnuva YÃ¶netimi</h1>

    <div class="card">
        <h3>âš™ï¸ Harf Ä°pucu AyarlarÄ±</h3>
        <div class="setting-row">
            <label>Harf aÃ§Ä±lma aralÄ±ÄŸÄ± (saniye): </label>
            <input type="number" id="harfSuresi" value="10" style="width: 60px; padding: 8px;">
            <small>Ã–rn: 10 yazarsanÄ±z her 10 saniyede bir rastgele harf aÃ§Ä±lÄ±r.</small>
        </div>
    </div>

    <div class="card">
        <button class="btn-green" onclick="eslestir()">ğŸ¤ EÅLEÅTÄ°R VE BAÅLAT</button>
        <button class="btn-red" onclick="sifirla()">SÄ°STEMÄ° SIFIRLA</button>
    </div>

    <div id="canli-maclar"></div>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
            authDomain: "kelime-avi-bec9f.firebaseapp.com",
            databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
            projectId: "kelime-avi-bec9f",
            storageBucket: "kelime-avi-bec9f.appspot.com",
            messagingSenderId: "154681825331",
            appId: "1:154681825331:web:7c8fec41e0d8ee2664eb46"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();
        var harfInterval;

        // Harf AÃ§ma Motoru
        function harfMotorunuBaslat() {
            if(harfInterval) clearInterval(harfInterval);
            var sn = document.getElementById("harfSuresi").value || 10;
            
            harfInterval = setInterval(() => {
                db.ref("turnuva/maclar").once("value", s => {
                    s.forEach(macSnap => {
                        var mac = macSnap.val();
                        if(mac.durum === "aktif") {
                            var r = mac.aktifRaunt;
                            var orjinal = mac.kelimeler[r].k;
                            var gizli = mac.kelimeler[r].gizli;
                            
                            // Rastgele bir '-' bul ve harfi aÃ§
                            var kapaliIndisler = [];
                            for(let i=0; i<gizli.length; i++) if(gizli[i] === "-") kapaliIndisler.push(i);
                            
                            if(kapaliIndisler.length > 1) { // Son harf kalana kadar aÃ§
                                var secilen = kapaliIndisler[Math.floor(Math.random() * kapaliIndisler.length)];
                                var yeniGizli = gizli.split("");
                                yeniGizli[secilen] = orjinal[secilen];
                                db.ref(`turnuva/maclar/${macSnap.key}/kelimeler/${r}/gizli`).set(yeniGizli.join(""));
                            }
                        }
                    });
                });
            }, sn * 1000);
        }

        function eslestir() {
            // ... (Ã–nceki eÅŸleÅŸtirme kodun buraya gelecek) ...
            // EÅŸleÅŸtirme sonunda:
            harfMotorunuBaslat();
            alert("Turnuva ve Harf Motoru BaÅŸladÄ±!");
        }

        // MaÃ§ Takibi GÃ¶rseli
        db.ref("turnuva/maclar").on("value", s => {
            var h = "";
            s.forEach(m => {
                var v = m.val();
                h += `<div class="match-card">${v.p1_ad} vs ${v.p2_ad} | Kelime: ${v.kelimeler[v.aktifRaunt].gizli}</div>`;
            });
            document.getElementById("canli-maclar").innerHTML = h;
        });

        function sifirla() { db.ref("turnuva").remove(); clearInterval(harfInterval); location.reload(); }
    </script>
</body>
</html>

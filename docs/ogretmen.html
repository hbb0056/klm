<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Ã–ÄŸretmen Paneli</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #fdfdfd; }
        .box { border: 1px solid #ddd; padding: 20px; margin-bottom: 20px; border-radius: 10px; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        button { cursor: pointer; padding: 8px 15px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f4f4f4; }
    </style>
</head>
<body>
    <h1>ğŸ‘©â€ğŸ« Ã–ÄŸretmen YÃ¶netim Merkezi</h1>

    <div class="box">
        <h3>ğŸ® Oyun KontrolÃ¼</h3>
        <button style="background:#2ecc71; color:white;" onclick="oyunAc()">OYUNU AÃ‡</button>
        <button style="background:#e74c3c; color:white;" onclick="oyunKapat()">OYUNU KAPAT VE SÄ°STEMÄ° SIFIRLA</button>
    </div>

    <div class="box">
        <h3>ğŸ“Š CanlÄ± Skor Tablosu</h3>
        <div id="ogrenciListesi">Ã–ÄŸrenci bekleniyor...</div>
    </div>

    <div class="box">
        <h3>ğŸ“š Kelime Havuzu</h3>
        <input id="k" placeholder="Kelime"> <input id="a" placeholder="Anlam" style="width:300px;">
        <button onclick="kelimeEkle()">Havuza Ekle</button>
        <hr>
        <div id="havuz"></div>
    </div>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
            authDomain: "kelime-avi-bec9f.firebaseapp.com",
            databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
            projectId: "kelime-avi-bec9f",
            storageBucket: "kelime-avi-bec9f.appspot.com",
            messagingSenderId: "154681825331",
            appId: "1:154681825331:web:7c8fec41e0d8ee2664eb46"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();
        var harfInterval;

        // Skor Tablosu Dinleyici
        db.ref("ogrenciler").on("value", function(s){
            var liste = [];
            s.forEach(e => { liste.push({id:e.key, ...e.val()}) });
            liste.sort((a,b) => (b.puan||0) - (a.puan||0));

            var html = "<table><tr><th>SÄ±ra</th><th>Ã–ÄŸrenci</th><th>Puan</th><th>Ä°ÅŸlem</th></tr>";
            liste.forEach((o, i) => {
                html += `<tr>
                    <td>${i+1}</td>
                    <td>${o.ad}</td>
                    <td><b>${o.puan||0}</b></td>
                    <td>${o.onay ? 'âœ…' : `<button onclick="onayla('${o.id}')">Onayla</button>`}</td>
                </tr>`;
            });
            document.getElementById("ogrenciListesi").innerHTML = (liste.length > 0) ? html + "</table>" : "Bekleyen Ã¶ÄŸrenci yok.";
        });

        function onayla(id){ db.ref("ogrenciler/"+id+"/onay").set(true); }
        
        function oyunAc(){ 
            db.ref("oyunDurum").set("acik"); 
        }

        // TAM SIFIRLAMA YAPAN FONKSÄ°YON
        function oyunKapat(){
            if(confirm("Oyun kapatÄ±lacak ve TÃœM Ã–ÄRENCÄ° LÄ°STESÄ° SÄ°LÄ°NECEK. Emin misiniz?")){
                if(harfInterval) clearInterval(harfInterval);
                db.ref("oyunDurum").set("kapali");
                db.ref("aktif").remove(); // Mevcut kelimeyi sil
                db.ref("ogrenciler").remove(); // TÃ¼m Ã¶ÄŸrenci verilerini sil
                alert("Sistem tamamen sÄ±fÄ±rlandÄ±.");
            }
        }

        function kelimeEkle(){
            var k = document.getElementById("k").value.toUpperCase().trim();
            var a = document.getElementById("a").value.trim();
            if(k && a) db.ref("kelimeler").push({kelime:k, anlam:a});
        }

        db.ref("kelimeler").on("value", s => {
            var html = "";
            s.forEach(e => {
                var d = e.val();
                html += `<div><b>${d.kelime}</b> <button onclick="kelimeBaslat('${e.key}')">BAÅLAT</button> <button onclick="db.ref('kelimeler/${e.key}').remove()">âŒ</button></div>`;
            });
            document.getElementById("havuz").innerHTML = html;
        });

        function kelimeBaslat(id){
            if(harfInterval) clearInterval(harfInterval);
            db.ref("kelimeler/"+id).once("value", s => {
                var d = s.val();
                var orjinal = d.kelime;
                var gizli = orjinal.replace(/./g, "-");
                var puan = 100;
                var guncelle = (g, p) => db.ref("aktif").set({kelime:orjinal, gizli:g, anlam:d.anlam, puan:p});
                guncelle(gizli, puan);

                harfInterval = setInterval(() => {
                    var kapali = [];
                    for(var i=0; i<gizli.length; i++) if(gizli[i]=="-") kapali.push(i);
                    if(kapali.length > 1 && puan > 10){
                        var r = kapali[Math.floor(Math.random()*kapali.length)];
                        var dizi = gizli.split("");
                        dizi[r] = orjinal[r];
                        gizli = dizi.join("");
                        puan -= 10;
                        guncelle(gizli, puan);
                    } else { clearInterval(harfInterval); }
                }, 20000);
            });
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>YÃ¶netim Paneli - Turnuva Modu</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; }
.card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
.flex { display: flex; gap: 20px; }
button { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; margin: 5px 2px; }
.btn-blue { background: #3498db; }
.btn-green { background: #2ecc71; }
.btn-red { background: #e74c3c; }
.btn-purple { background: #9b59b6; }
.list { max-height: 250px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 8px; background: #fff; }
.score-item { background: #2c3e50; color: white; padding: 10px; margin-bottom: 5px; border-radius: 6px; }
input { padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
</style>
</head>

<body>

<div class="card">
<h2>ğŸ† Turnuva YÃ¶netim Merkezi</h2>

<button class="btn-blue" onclick="baslat()">ğŸ® TURU BAÅLAT</button>
<button class="btn-purple" onclick="ustTuraGec()">â­ï¸ ÃœST TURA GEÃ‡ (Her Gruptan 2)</button>
<button class="btn-red" onclick="db.ref('turnuva/maclar').remove()">â¹ï¸ MAÃ‡LARI DURDUR</button>
<button style="background:black" onclick="if(confirm('Her ÅŸey silinecek!')) db.ref('turnuva').remove()">ğŸ§¹ SÄ°STEMÄ° SIFIRLA</button>

<br><br>

Kelime: <input type="number" id="kAdet" value="5" style="width:50px">
HÄ±z (sn): <input type="number" id="hiz" value="10" style="width:50px">

</div>

<div class="flex">

<div class="card" style="flex:1">
<h3>ğŸ“Š CanlÄ± Skorlar</h3>
<div id="canliSkorlar" class="list"></div>
</div>

<div class="card" style="flex:1">
<h3>ğŸ‘¥ Aktif Oyuncular (<span id="count">0</span>)</h3>
<div id="onayListesi" class="list"></div>
</div>

<div class="card" style="flex:1">
<h3>ğŸ“š Kelime Havuzu</h3>

<input id="k" placeholder="Kelime" style="width:80px">
<input id="a" placeholder="Ä°pucu" style="width:80px">
<button class="btn-green" onclick="kelimeEkle()">+</button>

<div id="havuzListesi" class="list" style="margin-top:10px"></div>

</div>

</div>

<script>

var firebaseConfig = {
    apiKey: "AIzaSy...",
    authDomain: "kelime-avi-bec9f.firebaseapp.com",
    databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
    projectId: "kelime-avi-bec9f"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

window.aktifler=[];

/* KELÄ°ME EKLEME */
function kelimeEkle(){
    var k=document.getElementById("k").value.toUpperCase().trim();
    var a=document.getElementById("a").value.trim();
    if(k && a){
        db.ref("turnuva/havuz").push({k,a});
        document.getElementById("k").value="";
        document.getElementById("a").value="";
    }
}

db.ref("turnuva/havuz").on("value",s=>{
    var h="";
    s.forEach(x=>{
        h+=`<div style="display:flex;justify-content:space-between;margin-bottom:5px">
        <span>${x.val().k}</span>
        <button class="btn-red" style="padding:2px 5px"
        onclick="db.ref('turnuva/havuz/${x.key}').remove()">X</button>
        </div>`;
    });
    document.getElementById("havuzListesi").innerHTML=h;
});

/* OYUNCU LÄ°STESÄ° */
db.ref("turnuva/oyuncular").on("value",s=>{
    var h="";
    window.aktifler=[];

    s.forEach(o=>{
        var d=o.val();

        if(d.durum==="onay_bekliyor"){
            h+=`${d.ad}
            <button class="btn-green"
            onclick="db.ref('turnuva/oyuncular/${o.key}/durum').set('bekliyor')">
            Onayla</button><br>`;
        }

        else if(d.durum==="bekliyor" || d.durum==="ust_tur"){
            window.aktifler.push({id:o.key, ad:d.ad});
            h+=`${d.ad} ${d.durum==="ust_tur"?"ğŸ† (Ãœst Tur)": "âœ…"}<br>`;
        }
    });

    document.getElementById("onayListesi").innerHTML=h;
    document.getElementById("count").innerText=window.aktifler.length;
});

/* TUR BAÅLAT */
function baslat(){

    if(window.aktifler.length < 2){
        alert("Yeterli oyuncu yok!");
        return;
    }

    db.ref("turnuva/havuz").once("value",hs=>{
        if(!hs.exists()){
            alert("Ã–nce kelime ekleyin!");
            return;
        }

        var havuz=[];
        hs.forEach(x=>havuz.push(x.val()));
        havuz.sort(()=>0.5-Math.random());

        var kels=havuz.slice(0,document.getElementById("kAdet").value)
        .map(x=>({k:x.k,i:x.a,gizli:x.k.replace(/[A-ZÃ‡ÄÄ°Ã–ÅÃœ]/g,"-")}));

        db.ref("turnuva/maclar").remove();

        let sk={},il={};

        window.aktifler.forEach(x=>{
            sk[x.ad]=0;
            il[x.ad]=0;
            db.ref("turnuva/oyuncular/"+x.id)
            .update({durum:"eslesti"});
        });

        db.ref("turnuva/maclar/TUR").set({
            tip:"tur",
            durum:"aktif",
            kelimeler:kels,
            skorlar:sk,
            ilerleme:il
        });
    });
}

/* ÃœST TURA GEÃ‡ */
async function ustTuraGec(){

    const snap=await db.ref("turnuva/maclar/TUR").once("value");
    if(!snap.exists()) return;

    let v=snap.val();
    let siralama=Object.entries(v.skorlar)
    .sort((a,b)=>b[1]-a[1]);

    let kazananlar=[];
    if(siralama[0]) kazananlar.push(siralama[0][0]);
    if(siralama[1]) kazananlar.push(siralama[1][0]);

    window.aktifler.forEach(o=>{
        if(kazananlar.includes(o.ad)){
            db.ref("turnuva/oyuncular/"+o.id)
            .update({durum:"ust_tur"});
        } else {
            db.ref("turnuva/oyuncular/"+o.id).remove();
        }
    });

    alert("Ãœst tura Ã§Ä±kanlar belirlendi!");
}

/* CANLI SKOR */
db.ref("turnuva/maclar").on("value",s=>{
    var h="";
    s.forEach(m=>{
        var v=m.val();
        h+=`<div class="score-item"><b>${m.key}</b><br>`;
        for(let t in v.skorlar)
            h+=`${t}: ${v.skorlar[t]} puan<br>`;
        h+=`</div>`;
    });
    document.getElementById("canliSkorlar").innerHTML=
    h || "Bekleniyor...";
});

</script>
</body>
</html>

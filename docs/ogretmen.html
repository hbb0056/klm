<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Kelime AvÄ± Turnuva Sistemi</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{margin:0;font-family:Segoe UI;background:#0f172a;color:white;}
.container{display:flex;height:100vh;}
.left{width:20%;background:#1e293b;padding:15px;overflow:auto;}
.middle{width:50%;padding:20px;overflow:auto;}
.right{width:30%;background:#1e293b;padding:20px;overflow:auto;}
.card{background:#334155;padding:15px;margin-bottom:15px;border-radius:10px;}
button{padding:6px 10px;border:none;border-radius:5px;background:#22c55e;color:white;cursor:pointer;margin-top:5px;}
input{padding:6px;margin:4px 0;width:90%;}
.match{background:#1e293b;padding:8px;margin:5px 0;border-radius:6px;}
.wordItem{background:#1e293b;padding:5px;margin:4px 0;border-radius:5px;display:flex;justify-content:space-between;}
</style>
</head>

<body>

<div class="container">

<div class="left">
<h3>Turnuva AÅŸamalarÄ±</h3>
<button onclick="gruplariOlustur()">GruplarÄ± OluÅŸtur</button>
<button onclick="grupMaclariniOlustur()">Grup MaÃ§larÄ±nÄ± OluÅŸtur</button>
<button onclick="ceyrekOlustur()">Ã‡eyrek Final</button>
<button onclick="yariOlustur()">YarÄ± Final</button>
<button onclick="finalOlustur()">Final</button>
<button onclick="sampiyonBelirle()">Åžampiyonu Belirle</button>
<hr>
<button onclick="db.ref('turnuva').remove()">Sistemi SÄ±fÄ±rla</button>
</div>

<div class="middle">

<h3>Turnuva AÄŸacÄ±</h3>

<div class="card">
<h4>Gruplar</h4>
<div id="gruplar"></div>
</div>

<div class="card">
<h4>Eleme TurlarÄ±</h4>
<div id="eleme"></div>
</div>

</div>

<div class="right">

<h3>Oyuncu Ekle</h3>
<input id="oyuncuAdi" placeholder="Oyuncu adÄ±">
<button onclick="oyuncuEkle()">Ekle</button>

<hr>

<h3>Kelime Havuzu</h3>
<input id="kelime" placeholder="Kelime">
<button onclick="kelimeEkle()">Kelime Ekle</button>
<div id="kelimeListesi"></div>

</div>
</div>

<script>

var firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  databaseURL: "https://PROJECT-default-rtdb.firebaseio.com",
  projectId: "PROJECT"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

/* OYUNCU EKLE */
function oyuncuEkle(){
  let ad=document.getElementById("oyuncuAdi").value;
  if(ad){
    db.ref("turnuva/oyuncular").push({ad:ad,puan:0,grup:""});
    document.getElementById("oyuncuAdi").value="";
  }
}

/* KELÄ°ME EKLE */
function kelimeEkle(){
  let k=document.getElementById("kelime").value.toUpperCase();
  if(k){
    db.ref("turnuva/havuz").push({kelime:k});
    document.getElementById("kelime").value="";
  }
}

/* KELÄ°ME LÄ°STE */
db.ref("turnuva/havuz").on("value",snap=>{
  let html="";
  snap.forEach(w=>{
    html+=`<div class="wordItem">
      ${w.val().kelime}
      <button onclick="db.ref('turnuva/havuz/${w.key}').remove()">X</button>
    </div>`;
  });
  document.getElementById("kelimeListesi").innerHTML=html;
});

/* GRUP OLUÅžTUR */
function gruplariOlustur(){
  db.ref("turnuva/oyuncular").once("value").then(snap=>{
    let oyuncular=[];
    snap.forEach(o=>oyuncular.push({id:o.key,...o.val()}));

    oyuncular.sort(()=>0.5-Math.random());
    let gruplar=["A","B","C","D"];

    let index=0;
    gruplar.forEach(g=>{
      for(let i=0;i<oyuncular.length/4;i++){
        if(oyuncular[index]){
          db.ref("turnuva/oyuncular/"+oyuncular[index].id).update({grup:g,puan:0});
          index++;
        }
      }
    });

    alert("Gruplar oluÅŸturuldu");
  });
}

/* GRUP MAÃ‡LARI */
function grupMaclariniOlustur(){
  db.ref("turnuva/oyuncular").once("value").then(snap=>{
    let gruplar={};
    snap.forEach(o=>{
      let g=o.val().grup;
      if(!gruplar[g]) gruplar[g]=[];
      gruplar[g].push({id:o.key,...o.val()});
    });

    db.ref("turnuva/maclar").remove();

    for(let g in gruplar){
      let list=gruplar[g];
      for(let i=0;i<list.length;i++){
        for(let j=i+1;j<list.length;j++){
          db.ref("turnuva/maclar").push({
            tip:"grup",
            grup:g,
            p1:list[i].ad,
            p2:list[j].ad,
            skor1:0,
            skor2:0
          });
        }
      }
    }

    alert("Grup maÃ§larÄ± oluÅŸturuldu");
  });
}

/* Ã‡EYREK */
function ceyrekOlustur(){
  db.ref("turnuva/oyuncular").once("value").then(snap=>{
    let gruplar={};
    snap.forEach(o=>{
      let g=o.val().grup;
      if(!gruplar[g]) gruplar[g]=[];
      gruplar[g].push(o.val());
    });

    let cikanlar=[];
    for(let g in gruplar){
      gruplar[g].sort((a,b)=>b.puan-a.puan);
      if(gruplar[g][0]) cikanlar.push(gruplar[g][0]);
      if(gruplar[g][1]) cikanlar.push(gruplar[g][1]);
    }

    cikanlar.sort(()=>0.5-Math.random());

    for(let i=0;i<cikanlar.length;i+=2){
      db.ref("turnuva/maclar").push({
        tip:"ceyrek",
        p1:cikanlar[i].ad,
        p2:cikanlar[i+1].ad,
        skor1:0,
        skor2:0
      });
    }

    alert("Ã‡eyrek final oluÅŸturuldu");
  });
}

/* YARI */
function yariOlustur(){
  elemeOlustur("ceyrek","yari");
}

/* FÄ°NAL */
function finalOlustur(){
  elemeOlustur("yari","final");
}

function elemeOlustur(onceki,sonraki){
  db.ref("turnuva/maclar").once("value").then(snap=>{
    let kazananlar=[];
    snap.forEach(m=>{
      let val=m.val();
      if(val.tip==onceki){
        if(val.skor1>val.skor2) kazananlar.push(val.p1);
        else kazananlar.push(val.p2);
      }
    });

    for(let i=0;i<kazananlar.length;i+=2){
      db.ref("turnuva/maclar").push({
        tip:sonraki,
        p1:kazananlar[i],
        p2:kazananlar[i+1],
        skor1:0,
        skor2:0
      });
    }

    alert(sonraki+" oluÅŸturuldu");
  });
}

/* ÅžAMPÄ°YON */
function sampiyonBelirle(){
  db.ref("turnuva/maclar").once("value").then(snap=>{
    snap.forEach(m=>{
      let val=m.val();
      if(val.tip=="final"){
        let s=val.skor1>val.skor2?val.p1:val.p2;
        alert("ðŸ† ÅžAMPÄ°YON: "+s);
      }
    });
  });
}

/* CANLI LÄ°STELEME */
db.ref("turnuva/oyuncular").on("value",snap=>{
  let html="";
  snap.forEach(o=>{
    html+=`<div class="match">
      ${o.val().ad} - Grup ${o.val().grup} - ${o.val().puan} P
    </div>`;
  });
  document.getElementById("gruplar").innerHTML=html;
});

db.ref("turnuva/maclar").on("value",snap=>{
  let html="";
  snap.forEach(m=>{
    let val=m.val();
    html+=`<div class="match">
      (${val.tip}) ${val.p1} ${val.skor1} - ${val.skor2} ${val.p2}
    </div>`;
  });
  document.getElementById("eleme").innerHTML=html;
});

</script>
</body>
</html>

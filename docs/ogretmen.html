<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Kelime AvÄ± - YÃ¶netim</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .flex { display: flex; gap: 20px; }
        .col { flex: 1; }
        button { cursor: pointer; padding: 10px 15px; border: none; border-radius: 6px; font-weight: bold; margin: 3px; color: white; }
        .btn-blue { background: #3498db; }
        .btn-green { background: #27ae60; }
        .btn-red { background: #e74c3c; }
        .btn-orange { background: #f39c12; }
        .list-box { max-height: 250px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; background: #fafafa; }
        .item { display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #eee; }
        .score-box { background: #2c3e50; color: white; padding: 12px; border-radius: 8px; margin-bottom: 10px; font-size: 14px; line-height: 1.5; }
    </style>
</head>
<body>
    <div class="card">
        <h2>ğŸ‘¨â€ğŸ« Kelime AvÄ± Kontrol Paneli</h2>
        Mod: <select id="mod" style="padding:8px;">
            <option value="grup">ğŸ† Grup AÅŸamasÄ± (Otomatik)</option>
            <option value="savas">ğŸ° TakÄ±m SavaÅŸÄ± (SeÃ§meli)</option>
            <option value="duello">âš”ï¸ DÃ¼ello (Teke Tek)</option>
        </select>
        | Kelime: <input type="number" id="kAdet" value="5" style="width:40px; padding:5px;">
        | HÄ±z: <input type="number" id="hiz" value="10" style="width:40px; padding:5px;">
        <br><br>
        <button class="btn-blue" style="font-size:16px;" onclick="baslat()">ğŸš€ GRUPLARI KUR VE BAÅLAT</button>
        <button class="btn-orange" onclick="db.ref('turnuva/maclar').remove()">â¹ï¸ MAÃ‡I BÄ°TÄ°R</button>
        <button class="btn-red" style="background:black;" onclick="sifirla()">ğŸ§¹ SÄ°STEMÄ° SIFIRLA</button>
    </div>

    <div class="flex">
        <div class="col card">
            <h3>ğŸ“Š CanlÄ± Skorlar & Gruplar</h3>
            <div id="canliSkorlar" class="list-box" style="background:#ecf0f1;">MaÃ§ bekleniyor...</div>
        </div>
        <div class="col card">
            <h3>ğŸ‘¥ Onay Bekleyenler</h3>
            <div id="onayListesi" class="list-box"></div>
        </div>
        <div class="col card">
            <h3>ğŸ“š Kelime Havuzu</h3>
            <input id="k" placeholder="Kelime" style="padding:8px; width:80px;"> 
            <input id="a" placeholder="Ä°pucu" style="padding:8px; width:120px;">
            <button class="btn-green" onclick="ekle()">EKLE</button>
            <div id="havuzListesi" class="list-box" style="margin-top:10px;"></div>
        </div>
    </div>

    <script>
        var firebaseConfig = { apiKey: "AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4", authDomain: "kelime-avi-bec9f.firebaseapp.com", databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com", projectId: "kelime-avi-bec9f", storageBucket: "kelime-avi-bec9f.appspot.com", messagingSenderId: "154681825331", appId: "1:154681825331:web:7c8fec41e0d8ee2664eb46" };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();

        function ekle() {
            var k = document.getElementById("k").value.toUpperCase().trim(), a = document.getElementById("a").value.trim();
            if(k && a) db.ref("turnuva/havuz").push({k, a});
            document.getElementById("k").value=""; document.getElementById("a").value="";
        }

        db.ref("turnuva/havuz").on("value", s => {
            var h = ""; s.forEach(x => { h += `<div class="item"><span><b>${x.val().k}</b></span> <button class="btn-red" style="padding:3px 8px" onclick="db.ref('turnuva/havuz/${x.key}').remove()">SÄ°L</button></div>`; });
            document.getElementById("havuzListesi").innerHTML = h;
        });

        db.ref("turnuva/oyuncular").on("value", s => {
            var h = ""; window.onaylilar = [];
            s.forEach(o => {
                var d = o.val();
                if(d.durum === "onay_bekliyor") h += `<div class="item">${d.ad} <button class="btn-green" style="padding:5px" onclick="db.ref('turnuva/oyuncular/${o.key}/durum').set('bekliyor')">Onayla</button></div>`;
                else { h += `<div class="item">${d.ad} âœ…</div>`; window.onaylilar.push({id:o.key, ad:d.ad}); }
            });
            document.getElementById("onayListesi").innerHTML = h;
        });

        db.ref("turnuva/maclar").on("value", s => {
            var h = "";
            s.forEach(m => {
                var v = m.val();
                h += `<div class="score-box"><strong>ğŸ“ ${m.key}</strong><br>`;
                if(v.tip === "duello") {
                    h += `âš”ï¸ ${v.p1_ad}: ${v.p1_skor} - ${v.p2_ad}: ${v.p2_skor}`;
                } else {
                    for(let tAd in v.skorlar) if(tAd !== "BAÅLIYOR") h += `ğŸš© ${tAd}: ${v.skorlar[tAd]} P | `;
                }
                h += `</div>`;
            });
            document.getElementById("canliSkorlar").innerHTML = h || "Aktif maÃ§ yok.";
        });

        function baslat() {
            var mod = document.getElementById("mod").value, kC = parseInt(document.getElementById("kAdet").value);
            db.ref("turnuva/havuz").once("value", hs => {
                if(!hs.exists()) return alert("Havuz boÅŸ!");
                var hav = []; hs.forEach(x => hav.push(x.val())); hav.sort(() => 0.5 - Math.random());
                var kels = hav.slice(0, kC).map(x => ({k:x.k, i:x.a, gizli:x.k.replace(/[A-ZÃ‡ÄÄ°Ã–ÅÃœ]/g,"-")}));
                var liste = window.onaylilar.sort(() => 0.5 - Math.random());

                if(mod === "grup") {
                    for(let i=0; i < Math.ceil(liste.length/4); i++) {
                        let u = liste.slice(i*4, (i*4)+4), sk = {};
                        u.forEach(x => { sk[x.ad] = 0; db.ref("turnuva/oyuncular/"+x.id).update({durum:"eslesti", takim:x.ad}); });
                        db.ref("turnuva/maclar/Grup-"+(i+1)).set({ tip:"grup", durum:"aktif", aktifRaunt:0, kelimeler:kels, skorlar:sk });
                    }
                } else if(mod === "savas") {
                    db.ref("turnuva/maclar/Takim-Savasi").set({ tip:"savas", durum:"aktif", aktifRaunt:0, kelimeler:kels, skorlar:{"SÄ°STEM":0} });
                    window.onaylilar.forEach(o => db.ref("turnuva/oyuncular/"+o.id+"/durum").set("takim_secme_ekrani"));
                } else if(mod === "duello") {
                    for(let i=0; i<liste.length; i+=2) if(liste[i+1]) {
                        db.ref("turnuva/maclar/Duel-"+(i/2+1)).set({ tip:"duello", durum:"aktif", p1:liste[i].id, p1_ad:liste[i].ad, p2:liste[i+1].id, p2_ad:liste[i+1].ad, p1_skor:0, p2_skor:0, aktifRaunt:0, kelimeler: kels });
                        db.ref("turnuva/oyuncular/"+liste[i].id).update({durum:"eslesti", takim:liste[i].ad});
                        db.ref("turnuva/oyuncular/"+liste[i+1].id).update({durum:"eslesti", takim:liste[i+1].ad});
                    }
                }
                motorBaslat();
            });
        }

        function motorBaslat() {
            var hz = document.getElementById("hiz").value; if(window.mtr) clearInterval(window.mtr);
            window.mtr = setInterval(() => {
                db.ref("turnuva/maclar").once("value", s => { s.forEach(ms => {
                    var m = ms.val(); if(m.durum === "aktif") {
                        var r = m.aktifRaunt, g = m.kelimeler[r].gizli, k = m.kelimeler[r].k;
                        var t = []; for(let i=0; i<g.length; i++) if(g[i]==="-") t.push(i);
                        if(t.length > 1) {
                            var sc = t[Math.floor(Math.random()*t.length)], y = g.split(""); y[sc] = k[sc];
                            db.ref(`turnuva/maclar/${ms.key}/kelimeler/${r}/gizli`).set(y.join(""));
                        }
                    }
                }); });
            }, hz * 1000);
        }
        function sifirla() { if(confirm("TÃ¼m sistem sÄ±fÄ±rlanacak?")) db.ref("turnuva").remove(); location.reload(); }
    </script>
</body>
</html>

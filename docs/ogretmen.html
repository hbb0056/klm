<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Ã–ÄŸretmen Paneli</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #fdfdfd; }
        .box { border: 1px solid #ddd; padding: 20px; margin-bottom: 20px; border-radius: 10px; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        button { cursor: pointer; padding: 8px 15px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f4f4f4; }
        .puan-hucre { font-size: 1.2em; color: #2c3e50; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ‘©â€ğŸ« Ã–ÄŸretmen YÃ¶netim Merkezi</h1>

    <div class="box">
        <h3>ğŸ® Oyun KontrolÃ¼</h3>
        <button style="background:#2ecc71; color:white;" onclick="oyunAc()">OYUNU AÃ‡ (GiriÅŸleri BaÅŸlat)</button>
        <button style="background:#e74c3c; color:white;" onclick="oyunKapat()">OYUNU KAPAT</button>
        <button style="background:#f1c40f;" onclick="puanlariSifirla()">ğŸ§¹ PuanlarÄ± SÄ±fÄ±rla</button>
    </div>

    <div class="box">
        <h3>ğŸ“Š CanlÄ± Skor Tablosu</h3>
        <div id="ogrenciListesi">Ã–ÄŸrenci bekleniyor...</div>
    </div>

    <div class="box">
        <h3>ğŸ“š Kelime Havuzu ve BaÅŸlatma</h3>
        <input id="k" placeholder="Kelime" style="padding:8px;"> 
        <input id="a" placeholder="Anlam/Ä°pucu" style="padding:8px; width:300px;">
        <button onclick="kelimeEkle()">Havuza Ekle</button>
        <hr>
        <div id="havuz"></div>
    </div>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
            authDomain: "kelime-avi-bec9f.firebaseapp.com",
            databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
            projectId: "kelime-avi-bec9f",
            storageBucket: "kelime-avi-bec9f.appspot.com",
            messagingSenderId: "154681825331",
            appId: "1:154681825331:web:7c8fec41e0d8ee2664eb46"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();
        var harfInterval;

        // CANLI SKOR VE ONAY TAKÄ°BÄ°
        db.ref("ogrenciler").on("value", function(s){
            var liste = [];
            s.forEach(e => { liste.push({id:e.key, ...e.val()}) });
            liste.sort((a,b) => (b.puan||0) - (a.puan||0));

            var html = "<table><tr><th>SÄ±ra</th><th>Ã–ÄŸrenci</th><th>Puan</th><th>Durum / Ä°ÅŸlem</th></tr>";
            liste.forEach((o, i) => {
                html += `<tr>
                    <td>${i+1}</td>
                    <td>${o.ad}</td>
                    <td class="puan-hucre">${o.puan||0}</td>
                    <td>${o.onay ? '<span style="color:green">âœ… OnaylÄ±</span>' : `<button onclick="onayla('${o.id}')">Onayla</button>`}</td>
                </tr>`;
            });
            document.getElementById("ogrenciListesi").innerHTML = html + "</table>";
        });

        function onayla(id){ db.ref("ogrenciler/"+id+"/onay").set(true); }
        function oyunAc(){ db.ref("oyunDurum").set("acik"); alert("Oyun aÃ§Ä±ldÄ±! OnaylÄ± Ã¶ÄŸrenciler oyuna girebilir."); }
        function oyunKapat(){ db.ref("oyunDurum").set("kapali"); alert("Oyun kapandÄ±."); }
        
        function puanlariSifirla(){
            if(confirm("TÃ¼m Ã¶ÄŸrencilerin puanlarÄ± sÄ±fÄ±rlanacak. Emin misiniz?")){
                db.ref("ogrenciler").once("value", s => {
                    s.forEach(e => { db.ref("ogrenciler/"+e.key+"/puan").set(0); });
                });
            }
        }

        function kelimeEkle(){
            var k = document.getElementById("k").value.toUpperCase().trim();
            var a = document.getElementById("a").value.trim();
            if(k && a) {
                db.ref("kelimeler").push({kelime:k, anlam:a});
                document.getElementById("k").value = ""; document.getElementById("a").value = "";
            }
        }

        // KELÄ°ME HAVUZUNU LÄ°STELE
        db.ref("kelimeler").on("value", s => {
            var html = "";
            s.forEach(e => {
                var d = e.val();
                html += `<div style="padding:10px; border-bottom:1px solid #eee;">
                    <b>${d.kelime}</b> - ${d.anlam} 
                    <button style="background:#3498db; color:white;" onclick="kelimeBaslat('${e.key}')">â–¶ OYUNU BAÅLAT</button>
                    <button onclick="db.ref('kelimeler/${e.key}').remove()">âŒ Sil</button>
                </div>`;
            });
            document.getElementById("havuz").innerHTML = html;
        });

        function kelimeBaslat(id){
            if(harfInterval) clearInterval(harfInterval);
            db.ref("kelimeler/"+id).once("value", s => {
                var d = s.val();
                var orjinal = d.kelime;
                var gizli = orjinal.replace(/./g, "-");
                var puan = 100;

                var guncelle = (g, p) => db.ref("aktif").set({kelime:orjinal, gizli:g, anlam:d.anlam, puan:p});
                guncelle(gizli, puan);

                harfInterval = setInterval(() => {
                    var kapaliIndeksler = [];
                    for(var i=0; i<gizli.length; i++) if(gizli[i]=="-") kapaliIndeksler.push(i);

                    if(kapaliIndeksler.length > 1 && puan > 10){
                        var rastgele = kapaliIndeksler[Math.floor(Math.random()*kapaliIndeksler.length)];
                        var dizi = gizli.split("");
                        dizi[rastgele] = orjinal[rastgele];
                        gizli = dizi.join("");
                        puan -= 10;
                        guncelle(gizli, puan);
                    } else {
                        clearInterval(harfInterval);
                    }
                }, 20000); // 20 saniyede bir harf aÃ§
                alert(orjinal + " kelimesi iÃ§in yarÄ±ÅŸma baÅŸladÄ±!");
            });
        }
    </script>
</body>
</html>

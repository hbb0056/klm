<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Ã–ÄŸretmen Paneli</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #fdfdfd; }
        .box { border: 1px solid #ddd; padding: 20px; margin-bottom: 20px; border-radius: 10px; background: #fff; }
        button { cursor: pointer; padding: 8px 15px; margin: 5px; border-radius: 5px; font-weight: bold; border: 1px solid #ccc; }
        .btn-start { background: #3498db; color: white; border: none; }
        .btn-start:disabled { background: #ccc !important; color: #666; cursor: not-allowed; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
    </style>
</head>
<body>
    <h1>ğŸ‘©â€ğŸ« Ã–ÄŸretmen YÃ¶netim Paneli</h1>

    <div class="box">
        <button style="background:#2ecc71; color:white; border:none;" onclick="oyunAc()">OYUNU AÃ‡ (GiriÅŸler)</button>
        <button style="background:#e74c3c; color:white; border:none;" onclick="oyunKapat()">SÄ°STEMÄ° SÄ°FÄ°RLA VE KAPAT</button>
    </div>

    <div class="box">
        <h3>ğŸ“Š Skorlar ve Onaylar</h3>
        <div id="ogrenciListesi">Bekleniyor...</div>
    </div>

    <div class="box">
        <h3>ğŸ“š Kelime Havuzu</h3>
        <input id="k" placeholder="Kelime"> <input id="a" placeholder="Anlam" style="width:250px;">
        <button onclick="kelimeEkle()">Havuza Ekle</button>
        <hr>
        <div id="havuz"></div>
    </div>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
            authDomain: "kelime-avi-bec9f.firebaseapp.com",
            databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
            projectId: "kelime-avi-bec9f",
            storageBucket: "kelime-avi-bec9f.appspot.com",
            messagingSenderId: "154681825331",
            appId: "1:154681825331:web:7c8fec41e0d8ee2664eb46"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();
        var harfInterval;
        var sorulanlar = JSON.parse(localStorage.getItem("sorulanlar") || "[]");

        db.ref("ogrenciler").on("value", s => {
            var liste = [];
            s.forEach(e => { liste.push({id:e.key, ...e.val()}) });
            liste.sort((a,b) => (b.puan||0) - (a.puan||0));
            var html = "<table><tr><th>Ad</th><th>Puan</th><th>Ä°ÅŸlem</th></tr>";
            liste.forEach(o => {
                html += `<tr><td>${o.ad}</td><td><b>${o.puan||0}</b></td><td>${o.onay ? 'âœ…' : `<button onclick="onayla('${o.id}')">Onayla</button>`}</td></tr>`;
            });
            document.getElementById("ogrenciListesi").innerHTML = html + "</table>";
        });

        function onayla(id){ db.ref("ogrenciler/"+id+"/onay").set(true); }
        function oyunAc(){ db.ref("oyunDurum").set("acik"); }
        
        function oyunKapat(){
            if(confirm("TÃœM Ã–ÄRENCÄ°LER VE PUANLAR SÄ°LÄ°NECEK! Emin misiniz?")){
                clearInterval(harfInterval);
                db.ref("oyunDurum").set("kapali");
                db.ref("aktif").remove();
                db.ref("ogrenciler").remove();
                localStorage.removeItem("sorulanlar");
                sorulanlar = [];
                location.reload();
            }
        }

        function kelimeEkle(){
            var k = document.getElementById("k").value.toUpperCase().trim();
            var a = document.getElementById("a").value.trim();
            if(k && a) db.ref("kelimeler").push({kelime:k, anlam:a});
        }

        db.ref("kelimeler").on("value", s => {
            var html = "";
            s.forEach(e => {
                var d = e.val();
                var used = sorulanlar.includes(e.key);
                html += `<div style="margin:5px;"><b>${d.kelime}</b> 
                <button id="btn-${e.key}" class="btn-start" onclick="kelimeBaslat('${e.key}')" ${used ? 'disabled' : ''}>
                    ${used ? 'SORULDU' : 'BAÅLAT'}
                </button></div>`;
            });
            document.getElementById("havuz").innerHTML = html;
        });

        function kelimeBaslat(id){
            if(harfInterval) clearInterval(harfInterval);
            sorulanlar.push(id);
            localStorage.setItem("sorulanlar", JSON.stringify(sorulanlar));
            
            db.ref("kelimeler/"+id).once("value", s => {
                var d = s.val();
                var orjinal = d.kelime;
                var gizli = orjinal.replace(/[A-ZÃ‡ÄÄ°Ã–ÅÃœ]/g, "-");
                var puan = 100;
                var harfBasina = Math.floor(100 / orjinal.length);

                var guncelle = (g, p) => db.ref("aktif").set({kelime:orjinal, gizli:g, anlam:d.anlam, puan:p});
                guncelle(gizli, puan);

                harfInterval = setInterval(() => {
                    var kapali = [];
                    for(var i=0; i<gizli.length; i++) if(gizli[i]=="-") kapali.push(i);
                    if(kapali.length > 0 && puan > harfBasina){
                        var r = kapali[Math.floor(Math.random()*kapali.length)];
                        var dizi = gizli.split("");
                        dizi[r] = orjinal[r];
                        gizli = dizi.join("");
                        puan -= harfBasina;
                        guncelle(gizli, puan);
                    } else { clearInterval(harfInterval); }
                }, 20000);
            });
            document.getElementById("btn-"+id).disabled = true;
            document.getElementById("btn-"+id).innerText = "SORULDU";
        }
    </script>
</body>
</html>

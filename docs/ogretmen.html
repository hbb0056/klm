<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>YÃ¶netim Paneli</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .flex { display: flex; gap: 20px; }
        .col { flex: 1; }
        button { cursor: pointer; padding: 10px; border-radius: 6px; border: none; font-weight: bold; }
        .btn-green { background: #27ae60; color: white; }
        .btn-blue { background: #3498db; color: white; }
        .btn-red { background: #e74c3c; color: white; }
        .list-box { max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; }
        .item { display: flex; justify-content: space-between; margin-bottom: 5px; border-bottom: 1px solid #eee; padding: 5px; }
    </style>
</head>
<body>
    <div class="card">
        <h2>ðŸŽ® Turnuva Kontrol Merkezi</h2>
        <div style="background:#dfe6e9; padding:15px; border-radius:10px;">
            Mod: <select id="mod"><option value="duello">DÃ¼ello</option><option value="grup">Grup AÅŸamasÄ±</option><option value="savas">TakÄ±m SavaÅŸÄ±</option></select>
            | Kelime: <input type="number" id="kAdet" value="5" style="width:40px;">
            | HÄ±z: <input type="number" id="hiz" value="10" style="width:40px;">
            <button class="btn-blue" onclick="baslat()">ðŸš€ BAÅžLAT</button>
            <button class="btn-red" onclick="db.ref('turnuva/maclar').remove()">MaÃ§larÄ± Sil</button>
            <button class="btn-red" style="background:black" onclick="if(confirm('Her ÅŸey silinsin mi?')) db.ref('turnuva').remove()">SÄ±fÄ±rla</button>
        </div>
    </div>
    <div class="flex">
        <div class="col card">
            <h3>ðŸ‘¥ Bekleyenler</h3>
            <div id="onayListesi" class="list-box"></div>
        </div>
        <div class="col card">
            <h3>ðŸ“Š Puan Havuzu</h3>
            <div id="skorListesi" class="list-box"></div>
        </div>
    </div>
    <div class="card">
        <h3>ðŸ“š Kelime Ekle</h3>
        <input id="k" placeholder="Kelime"> <input id="a" placeholder="Ä°pucu">
        <button class="btn-green" onclick="ekle()">EKLE</button>
    </div>

    <script>
        var firebaseConfig = { apiKey: "AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4", authDomain: "kelime-avi-bec9f.firebaseapp.com", databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com", projectId: "kelime-avi-bec9f", storageBucket: "kelime-avi-bec9f.appspot.com", messagingSenderId: "154681825331", appId: "1:154681825331:web:7c8fec41e0d8ee2664eb46" };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();

        function ekle() {
            var k=document.getElementById("k").value.toUpperCase().trim(), a=document.getElementById("a").value.trim();
            if(k && a) db.ref("turnuva/havuz").push({k, a});
            document.getElementById("k").value=""; document.getElementById("a").value="";
        }

        db.ref("turnuva/oyuncular").on("value", s => {
            var html = ""; window.liste = [];
            s.forEach(o => {
                var d = o.val();
                if(d.durum === "onay_bekliyor") html += `<div class="item">${d.ad} (${d.takim}) <button class="btn-green" onclick="db.ref('turnuva/oyuncular/${o.key}/durum').set('bekliyor')">Onayla</button></div>`;
                else if(d.durum === "bekliyor") window.liste.push({id:o.key, ad:d.ad, takim:d.takim});
            });
            document.getElementById("onayListesi").innerHTML = html;
        });

        function baslat() {
            var m = document.getElementById("mod").value, kC = parseInt(document.getElementById("kAdet").value);
            db.ref("turnuva/havuz").once("value", hs => {
                var h = []; hs.forEach(x => h.push(x.val()));
                h = h.sort(() => 0.5 - Math.random());
                if(m === "savas") {
                    var sk = {}; window.liste.forEach(o => sk[o.takim] = 0);
                    db.ref("turnuva/maclar/savas").set({ tip:"savas", durum:"aktif", aktifRaunt:0, kelimeler: h.slice(0, kC).map(x=>({k:x.k, i:x.a, gizli:x.k.replace(/[A-ZÃ‡ÄžÄ°Ã–ÅžÃœ]/g,"-")})), skorlar: sk });
                } else if(m === "duello") {
                    for(let i=0; i<window.liste.length; i+=2) {
                        if(window.liste[i+1]) {
                            var p1=window.liste[i], p2=window.liste[i+1];
                            db.ref("turnuva/maclar").push().set({ tip:"duello", durum:"aktif", p1:p1.id, p1_ad:p1.ad, p2:p2.id, p2_ad:p2.ad, p1_skor:0, p2_skor:0, aktifRaunt:0, kelimeler: h.slice(0, kC).map(x=>({k:x.k, i:x.a, gizli:x.k.replace(/[A-ZÃ‡ÄžÄ°Ã–ÅžÃœ]/g,"-")})) });
                        }
                    }
                }
                db.ref("turnuva/oyuncular").once("value", s => { s.forEach(o => { if(o.val().durum === "bekliyor") db.ref("turnuva/oyuncular/"+o.key+"/durum").set("eslesti"); }); });
                motorBaslat();
            });
        }

        function motorBaslat() {
            var s = document.getElementById("hiz").value;
            if(window.mtr) clearInterval(window.mtr);
            window.mtr = setInterval(() => {
                db.ref("turnuva/maclar").once("value", s => {
                    s.forEach(ms => {
                        var m = ms.val(); if(m.durum === "aktif") {
                            var r = m.aktifRaunt, g = m.kelimeler[r].gizli, k = m.kelimeler[r].k;
                            var t = []; for(let i=0; i<g.length; i++) if(g[i]==="-") t.push(i);
                            if(t.length > 1) {
                                var sec = t[Math.floor(Math.random()*t.length)];
                                var yeni = g.split(""); yeni[sec] = k[sec];
                                db.ref(`turnuva/maclar/${ms.key}/kelimeler/${r}/gizli`).set(yeni.join(""));
                            }
                        }
                    });
                });
            }, s * 1000);
        }
    </script>
</body>
</html>

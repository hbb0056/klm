<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Turnuva Yönetim Paneli</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
    margin:0;
    font-family:Segoe UI;
    background:#0f172a;
    color:white;
}
.container{display:flex;height:100vh;}
.left{width:20%;background:#1e293b;padding:15px;overflow:auto;}
.middle{width:50%;padding:20px;overflow:auto;}
.right{width:30%;background:#1e293b;padding:20px;overflow:auto;}
.card{background:#1e293b;padding:15px;margin-bottom:15px;border-radius:10px;}
.stat{flex:1;background:#334155;padding:15px;border-radius:10px;text-align:center;}
.dashboard{display:flex;gap:15px;margin-bottom:20px;}
.bracket{display:flex;justify-content:space-between;}
.round{width:23%;}
.match{background:#334155;padding:8px;margin-bottom:10px;border-radius:6px;}
button{padding:6px 10px;border:none;border-radius:5px;background:#22c55e;color:white;cursor:pointer;margin-top:5px;}
input{padding:6px;margin:4px 0;width:90%;}
</style>
</head>

<body>

<div class="container">

<div class="left">
<h3>Turnuva Aşamaları</h3>
<div id="dynamicStages"></div>
</div>

<div class="middle">

<div class="dashboard">
<div class="stat">
<h4>Toplam Oyuncu</h4>
<div id="toplam">0</div>
</div>
<div class="stat">
<h4>Aktif Maç</h4>
<div id="aktifMac">0</div>
</div>
<div class="stat">
<h4>En İyi Oyuncu</h4>
<div id="enIyi">-</div>
</div>
</div>

<h3>Turnuva Ağacı</h3>

<div class="bracket">
<div class="round"><h4>Gruplar</h4><div id="round_grup"></div></div>
<div class="round"><h4>Çeyrek</h4><div id="round_ceyrek"></div></div>
<div class="round"><h4>Yarı</h4><div id="round_yari"></div></div>
<div class="round"><h4>Final</h4><div id="round_final"></div></div>
</div>

</div>

<div class="right">

<h3>Kelime Havuzu</h3>

Kelime
<input id="kelime">

İpucu
<input id="ipucu">

<button onclick="kelimeEkle()">Ekle</button>

<hr>

Kelime Sayısı
<input type="number" id="kAdet" value="5">

Harf Açılma Hızı
<input type="number" id="hiz" value="10">

<button onclick="aiGrupBaslat()">AI Grup Oluştur</button>

<hr>

<button onclick="db.ref('turnuva').remove()">Sistemi Sıfırla</button>
<button onclick="db.ref('turnuva/havuz').remove()">Kelimeleri Sil</button>
<button onclick="db.ref('turnuva/oyuncular').remove()">Oyuncuları At</button>

</div>

</div>

<script>

var firebaseConfig = {
    apiKey: "AIzaSy...",
    authDomain: "kelime-avi-bec9f.firebaseapp.com",
    databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
    projectId: "kelime-avi-bec9f"
};

firebase.initializeApp(firebaseConfig);
var db=firebase.database();

/* DASHBOARD */
db.ref("turnuva/oyuncular").on("value",snap=>{
    document.getElementById("toplam").innerText=snap.numChildren();
});

db.ref("turnuva/maclar").on("value",snap=>{
    document.getElementById("aktifMac").innerText=snap.numChildren();
});

/* SKOR ANALİZ */
db.ref("turnuva/maclar").on("value",snap=>{
    let enYuksek=0;
    let enIyi="-";

    snap.forEach(mac=>{
        let skorlar=mac.val().skorlar;
        for(let o in skorlar){
            if(skorlar[o]>enYuksek){
                enYuksek=skorlar[o];
                enIyi=o;
            }
        }
    });

    document.getElementById("enIyi").innerText=enIyi;
});

/* KELİME EKLE */
function kelimeEkle(){
    var k=document.getElementById("kelime").value.toUpperCase();
    var i=document.getElementById("ipucu").value;
    if(k && i){
        db.ref("turnuva/havuz").push({k:k,a:i});
        document.getElementById("kelime").value="";
        document.getElementById("ipucu").value="";
    }
}

/* AI EŞLEŞTİRME */
function aiGrupBaslat(){

    db.ref("turnuva/oyuncular").once("value").then(snap=>{
        let oyuncular=[];

        snap.forEach(o=>{
            oyuncular.push({
                id:o.key,
                ad:o.val().ad,
                performans:Math.random()*100
            });
        });

        oyuncular.sort((a,b)=>b.performans-a.performans);

        let grupA=[],grupB=[],grupC=[];
        let ileri=true,index=0;
        let gruplar=[grupA,grupB,grupC];

        oyuncular.forEach(o=>{
            gruplar[index].push(o);
            if(ileri){
                index++;
                if(index==2) ileri=false;
            }else{
                index--;
                if(index==0) ileri=true;
            }
        });

        db.ref("turnuva/maclar").remove();

        grupOlustur("Grup-A",grupA);
        grupOlustur("Grup-B",grupB);
        grupOlustur("Grup-C",grupC);
    });
}

/* GRUP OLUŞTUR */
function grupOlustur(ad, liste){

    if(liste.length==0) return;

    let skor={},ilerleme={};

    liste.forEach(o=>{
        skor[o.ad]=0;
        ilerleme[o.ad]=0;
    });

    db.ref("turnuva/maclar/"+ad).set({
        tip:"grup",
        durum:"aktif",
        skorlar:skor,
        ilerleme:ilerleme
    });
}

/* OTOMATİK ÜST TUR */
function macBitir(macAdi, ustTur){

    db.ref("turnuva/maclar/"+macAdi).once("value").then(snap=>{
        if(!snap.exists()) return;

        let siralama=Object.entries(snap.val().skorlar)
            .sort((a,b)=>b[1]-a[1]);

        let kazanan=siralama[0][0];

        db.ref("turnuva/maclar/"+ustTur+"/"+kazanan).set(true);

        db.ref("turnuva/maclar/"+macAdi+"/durum").set("bitti");
    });
}

/* BRACKET */
db.ref("turnuva/maclar").on("value",snap=>{

    document.getElementById("round_grup").innerHTML="";
    document.getElementById("round_ceyrek").innerHTML="";
    document.getElementById("round_yari").innerHTML="";
    document.getElementById("round_final").innerHTML="";

    snap.forEach(m=>{
        let div=document.createElement("div");
        div.className="match";
        div.innerHTML=m.key;

        if(m.key.includes("Grup"))
            document.getElementById("round_grup").appendChild(div);
        else if(m.key.includes("Ceyrek"))
            document.getElementById("round_ceyrek").appendChild(div);
        else if(m.key.includes("Yari"))
            document.getElementById("round_yari").appendChild(div);
        else if(m.key.includes("Final"))
            document.getElementById("round_final").appendChild(div);
    });
});

/* SOL PANEL DİNAMİK */
db.ref("turnuva/maclar").on("value",snap=>{
    let html="";
    snap.forEach(m=>{
        html+=`
        <div class="card">
        <b>${m.key}</b><br>
        <button onclick="macBitir('${m.key}','Final')">Maçı Bitir</button>
        </div>`;
    });
    document.getElementById("dynamicStages").innerHTML=html;
});

</script>

</body>
</html>

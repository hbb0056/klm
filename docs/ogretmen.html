<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Turnuva YÃ¶netimi</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f2f5; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        button { cursor: pointer; padding: 12px 20px; border-radius: 8px; border: none; font-weight: bold; margin: 5px; }
        .btn-green { background: #27ae60; color: white; }
        .btn-red { background: #c0392b; color: white; }
        .match-box { border-left: 5px solid #2980b9; background: #ecf0f1; padding: 15px; margin: 10px 0; border-radius: 5px; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 5px; width: 200px; }
    </style>
</head>
<body>
    <h1>ğŸŸï¸ Kelime TurnuvasÄ± YÃ¶netimi</h1>

    <div class="card">
        <h3>1. Kelime Havuzu OluÅŸtur (En az 3 kelime)</h3>
        <input id="k" placeholder="Kelime"> <input id="a" placeholder="Ä°pucu">
        <button class="btn-green" onclick="ekle()">Havuzuna Ekle</button>
        <div id="havuz-sayisi" style="margin-top:10px; font-weight:bold;">Havuzdaki Kelime: 0</div>
    </div>

    <div class="card">
        <button class="btn-green" onclick="eslestir()">ğŸ¤ RAKÄ°PLERÄ° EÅLEÅTÄ°R VE BAÅLAT</button>
        <button class="btn-red" onclick="sifirla()">ğŸ§¹ SÄ°STEMÄ° SIFIRLA</button>
    </div>

    <div class="card">
        <h3>âš”ï¸ CanlÄ± DÃ¼ellolar (3 Kelimelik MaÃ§lar)</h3>
        <div id="macListesi"></div>
    </div>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBwzlkq9LZYCM_sk_M6tKfx5jme37Zw0u4",
            authDomain: "kelime-avi-bec9f.firebaseapp.com",
            databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
            projectId: "kelime-avi-bec9f",
            storageBucket: "kelime-avi-bec9f.appspot.com",
            messagingSenderId: "154681825331",
            appId: "1:154681825331:web:7c8fec41e0d8ee2664eb46"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();

        function ekle() {
            var k = document.getElementById("k").value.toUpperCase().trim();
            var a = document.getElementById("a").value.trim();
            if(k && a) {
                db.ref("turnuva/havuz").push({k: k, i: a});
                document.getElementById("k").value = "";
                document.getElementById("a").value = "";
            }
        }

        db.ref("turnuva/havuz").on("value", s => {
            document.getElementById("havuz-sayisi").innerText = "Havuzdaki Kelime: " + s.numChildren();
        });

        function eslestir() {
            db.ref("turnuva").once("value", turnuvaS => {
                var havuz = [];
                turnuvaS.child("havuz").forEach(h => { havuz.push(h.val()); });
                if(havuz.length < 3) return alert("Ã–nce havuzda en az 3 kelime olmalÄ±!");

                var bekleyenler = [];
                turnuvaS.child("oyuncular").forEach(o => { 
                    if(o.val().durum === "bekliyor") bekleyenler.push({id: o.key, ad: o.val().ad}); 
                });

                for(var i=0; i < bekleyenler.length; i+=2) {
                    if(bekleyenler[i+1]) {
                        var p1 = bekleyenler[i];
                        var p2 = bekleyenler[i+1];
                        
                        // Rastgele 3 kelime seÃ§
                        var secilenler = havuz.sort(() => 0.5 - Math.random()).slice(0, 3).map(item => ({
                            k: item.k, i: item.i, gizli: item.k.replace(/[A-ZÃ‡ÄÄ°Ã–ÅÃœ]/g, "-")
                        }));

                        var macID = db.ref("turnuva/maclar").push().key;
                        db.ref("turnuva/maclar/" + macID).set({
                            p1: p1.id, p2: p2.id, p1_ad: p1.ad, p2_ad: p2.ad,
                            kelimeler: secilenler, aktifRaunt: 0,
                            p1_skor: 0, p2_skor: 0, durum: "aktif", winner: ""
                        });
                        
                        db.ref("turnuva/oyuncular/" + p1.id + "/durum").set("eslesti");
                        db.ref("turnuva/oyuncular/" + p2.id + "/durum").set("eslesti");
                    }
                }
            });
        }

        db.ref("turnuva/maclar").on("value", s => {
            var html = "";
            s.forEach(m => {
                var v = m.val();
                html += `<div class="match-box">
                    <b>${v.p1_ad} (${v.p1_skor}) vs ${v.p2_ad} (${v.p2_skor})</b><br>
                    Durum: ${v.durum === "aktif" ? "Devam Ediyor (Kelime "+(v.aktifRaunt+1)+")" : "BÄ°TTÄ° - Kazanan: " + v.winner}
                </div>`;
                
                if(v.durum === "bitti" && v.winner !== "") {
                    db.ref("turnuva/oyuncular/" + v.winner + "/durum").set("bekliyor");
                    var loser = (v.winner === v.p1) ? v.p2 : v.p1;
                    db.ref("turnuva/oyuncular/" + loser).remove();
                }
            });
            document.getElementById("macListesi").innerHTML = html;
        });

        function sifirla() {
            if(confirm("TÃ¼m turnuva ve oyuncular silinsin mi?")) {
                db.ref("turnuva/oyuncular").remove();
                db.ref("turnuva/maclar").remove();
                location.reload();
            }
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Turnuva Yönetim Paneli</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{margin:0;font-family:Segoe UI;background:#0f172a;color:white;}
.container{display:flex;height:100vh;}
.left{width:20%;background:#1e293b;padding:15px;overflow:auto;}
.middle{width:50%;padding:20px;overflow:auto;}
.right{width:30%;background:#1e293b;padding:20px;overflow:auto;}
.card{background:#334155;padding:15px;margin-bottom:15px;border-radius:10px;}
.stat{flex:1;background:#1e293b;padding:15px;border-radius:10px;text-align:center;}
.dashboard{display:flex;gap:15px;margin-bottom:20px;}
.bracket{display:flex;justify-content:space-between;}
.round{width:23%;}
.match{background:#1e293b;padding:8px;margin-bottom:10px;border-radius:6px;}
button{padding:6px 10px;border:none;border-radius:5px;background:#22c55e;color:white;cursor:pointer;margin-top:5px;}
input{padding:6px;margin:4px 0;width:90%;}
.wordItem{background:#1e293b;padding:5px;margin:4px 0;border-radius:5px;display:flex;justify-content:space-between;}
</style>
</head>

<body>

<div class="container">

<div class="left">
<h3>Turnuva Aşamaları</h3>
<div id="dynamicStages"></div>
</div>

<div class="middle">

<div class="dashboard">
<div class="stat">
<h4>Toplam Oyuncu</h4>
<div id="toplam">0</div>
</div>
<div class="stat">
<h4>Aktif Maç</h4>
<div id="aktifMac">0</div>
</div>
<div class="stat">
<h4>En Yüksek Skor</h4>
<div id="enIyi">-</div>
</div>
</div>

<h3>Turnuva Ağacı</h3>

<div class="bracket">
<div class="round"><h4>Gruplar</h4><div id="round_grup"></div></div>
<div class="round"><h4>Çeyrek</h4><div id="round_ceyrek"></div></div>
<div class="round"><h4>Yarı</h4><div id="round_yari"></div></div>
<div class="round"><h4>Final</h4><div id="round_final"></div></div>
</div>

</div>

<div class="right">

<h3>Kelime Havuzu</h3>

Kelime
<input id="kelime">

İpucu
<input id="ipucu">

<button onclick="kelimeEkle()">Kelime Ekle</button>

<div id="kelimeListesi"></div>

<hr>

Kelime Sayısı
<input type="number" id="kAdet" value="5">

Harf Açılma Hızı
<input type="number" id="hiz" value="10">

<button onclick="aiGrupBaslat()">AI Grup Oluştur</button>
<button onclick="oyunuBaslat()">OYUNU BAŞLAT</button>

<hr>

<button onclick="db.ref('turnuva').remove()">Sistemi Sıfırla</button>
<button onclick="db.ref('turnuva/havuz').remove()">Kelimeleri Sil</button>
<button onclick="db.ref('turnuva/oyuncular').remove()">Oyuncuları At</button>

</div>

</div>

<script>

var firebaseConfig = {
    apiKey: "AIzaSy...",
    authDomain: "kelime-avi-bec9f.firebaseapp.com",
    databaseURL: "https://kelime-avi-bec9f-default-rtdb.firebaseio.com",
    projectId: "kelime-avi-bec9f"
};

firebase.initializeApp(firebaseConfig);
var db=firebase.database();

/* DASHBOARD */
db.ref("turnuva/oyuncular").on("value",snap=>{
    document.getElementById("toplam").innerText=snap.numChildren();
});

db.ref("turnuva/maclar").on("value",snap=>{
    document.getElementById("aktifMac").innerText=snap.numChildren();

    let enYuksek=0;
    snap.forEach(m=>{
        let s=m.val().skorlar;
        if(s){
            for(let o in s){
                if(s[o]>enYuksek) enYuksek=s[o];
            }
        }
    });

    document.getElementById("enIyi").innerText=enYuksek;
});

/* KELİME EKLE */
function kelimeEkle(){
    var k=document.getElementById("kelime").value.toUpperCase();
    var i=document.getElementById("ipucu").value;
    if(k && i){
        db.ref("turnuva/havuz").push({k:k,a:i});
        document.getElementById("kelime").value="";
        document.getElementById("ipucu").value="";
    }
}

/* KELİME LİSTELE */
db.ref("turnuva/havuz").on("value",snap=>{
    let html="";
    snap.forEach(w=>{
        html+=`
        <div class="wordItem">
        ${w.val().k}
        <button onclick="db.ref('turnuva/havuz/${w.key}').remove()">X</button>
        </div>`;
    });
    document.getElementById("kelimeListesi").innerHTML=html;
});

/* AI GRUP */
function aiGrupBaslat(){

    db.ref("turnuva/oyuncular").once("value").then(snap=>{
        let oyuncular=[];
        snap.forEach(o=>{
            oyuncular.push({ad:o.val().ad});
        });

        if(oyuncular.length<2){
            alert("Yeterli oyuncu yok");
            return;
        }

        oyuncular.sort(()=>0.5-Math.random());

        db.ref("turnuva/maclar").remove();

        let skor={},ilerleme={};
        oyuncular.forEach(o=>{
            skor[o.ad]=0;
            ilerleme[o.ad]=0;
        });

        db.ref("turnuva/maclar/Grup-1").set({
            tip:"grup",
            durum:"hazir",
            skorlar:skor,
            ilerleme:ilerleme
        });
    });
}

/* OYUNU BAŞLAT */
function oyunuBaslat(){

    db.ref("turnuva/havuz").once("value").then(hsnap=>{

        let havuz=[];
        hsnap.forEach(w=>havuz.push(w.val()));

        if(havuz.length==0){
            alert("Kelime yok!");
            return;
        }

        db.ref("turnuva/maclar/Grup-1").once("value").then(msnap=>{

            if(!msnap.exists()){
                alert("Önce grup oluştur!");
                return;
            }

            let mac=msnap.val();

            let secilen=havuz
                .sort(()=>0.5-Math.random())
